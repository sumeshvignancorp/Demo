<html>
<head>
<title>argparsing.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
argparsing.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">argparse</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">warnings</span>
<span class="s0">from </span><span class="s1">gettext </span><span class="s0">import </span><span class="s1">gettext</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Any</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Callable</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">cast</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Dict</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">List</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Mapping</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">NoReturn</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Optional</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Sequence</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Tuple</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">TYPE_CHECKING</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Union</span>

<span class="s0">import </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_io</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">compat </span><span class="s0">import </span><span class="s1">final</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">exceptions </span><span class="s0">import </span><span class="s1">UsageError</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">deprecated </span><span class="s0">import </span><span class="s1">ARGUMENT_PERCENT_DEFAULT</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">deprecated </span><span class="s0">import </span><span class="s1">ARGUMENT_TYPE_STR</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">deprecated </span><span class="s0">import </span><span class="s1">ARGUMENT_TYPE_STR_CHOICE</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">deprecated </span><span class="s0">import </span><span class="s1">check_ispytest</span>

<span class="s0">if </span><span class="s1">TYPE_CHECKING</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">typing_extensions </span><span class="s0">import </span><span class="s1">Literal</span>

<span class="s1">FILE_OR_DIR </span><span class="s2">= </span><span class="s3">&quot;file_or_dir&quot;</span>


<span class="s2">@</span><span class="s1">final</span>
<span class="s0">class </span><span class="s1">Parser</span><span class="s2">:</span>
    <span class="s4">&quot;&quot;&quot;Parser for command line arguments and ini-file values. 
 
    :ivar extra_info: Dict of generic param -&gt; value to display in case 
        there's an error processing the command line arguments. 
    &quot;&quot;&quot;</span>

    <span class="s1">prog</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">usage</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">processopt</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Callable</span><span class="s2">[[</span><span class="s3">&quot;Argument&quot;</span><span class="s2">], </span><span class="s0">None</span><span class="s2">]] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s2">*,</span>
        <span class="s1">_ispytest</span><span class="s2">: </span><span class="s1">bool </span><span class="s2">= </span><span class="s0">False</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">check_ispytest</span><span class="s2">(</span><span class="s1">_ispytest</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_anonymous </span><span class="s2">= </span><span class="s1">OptionGroup</span><span class="s2">(</span><span class="s3">&quot;Custom options&quot;</span><span class="s2">, </span><span class="s1">parser</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">_ispytest</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_groups</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">OptionGroup</span><span class="s2">] = []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_processopt </span><span class="s2">= </span><span class="s1">processopt</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_usage </span><span class="s2">= </span><span class="s1">usage</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_inidict</span><span class="s2">: </span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">], </span><span class="s1">Any</span><span class="s2">]] = {}</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_ininames</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">extra_info</span><span class="s2">: </span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">] = {}</span>

    <span class="s0">def </span><span class="s1">processoption</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">option</span><span class="s2">: </span><span class="s3">&quot;Argument&quot;</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_processopt</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">option</span><span class="s2">.</span><span class="s1">dest</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_processopt</span><span class="s2">(</span><span class="s1">option</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">getgroup</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">description</span><span class="s2">: </span><span class="s1">str </span><span class="s2">= </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s1">after</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s3">&quot;OptionGroup&quot;</span><span class="s2">:</span>
        <span class="s4">&quot;&quot;&quot;Get (or create) a named option Group. 
 
        :param name: Name of the option group. 
        :param description: Long description for --help output. 
        :param after: Name of another group, used for ordering --help output. 
        :returns: The option group. 
 
        The returned group object has an ``addoption`` method with the same 
        signature as :func:`parser.addoption &lt;pytest.Parser.addoption&gt;` but 
        will be shown in the respective group in the output of 
        ``pytest --help``. 
        &quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">group </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_groups</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">group</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s1">name</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">group</span>
        <span class="s1">group </span><span class="s2">= </span><span class="s1">OptionGroup</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">description</span><span class="s2">, </span><span class="s1">parser</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">_ispytest</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">i </span><span class="s2">= </span><span class="s5">0</span>
        <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">grp </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_groups</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">grp</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s1">after</span><span class="s2">:</span>
                <span class="s0">break</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_groups</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">group</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">group</span>

    <span class="s0">def </span><span class="s1">addoption</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">opts</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, **</span><span class="s1">attrs</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s4">&quot;&quot;&quot;Register a command line option. 
 
        :param opts: 
            Option names, can be short or long options. 
        :param attrs: 
            Same attributes as the argparse library's :py:func:`add_argument() 
            &lt;argparse.ArgumentParser.add_argument&gt;` function accepts. 
 
        After command line parsing, options are available on the pytest config 
        object via ``config.option.NAME`` where ``NAME`` is usually set 
        by passing a ``dest`` attribute, for example 
        ``addoption(&quot;--long&quot;, dest=&quot;NAME&quot;, ...)``. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_anonymous</span><span class="s2">.</span><span class="s1">addoption</span><span class="s2">(*</span><span class="s1">opts</span><span class="s2">, **</span><span class="s1">attrs</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">parse</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">args</span><span class="s2">: </span><span class="s1">Sequence</span><span class="s2">[</span><span class="s1">Union</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s3">&quot;os.PathLike[str]&quot;</span><span class="s2">]],</span>
        <span class="s1">namespace</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">:</span>
        <span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_argcomplete </span><span class="s0">import </span><span class="s1">try_argcomplete</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">optparser </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_getparser</span><span class="s2">()</span>
        <span class="s1">try_argcomplete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">optparser</span><span class="s2">)</span>
        <span class="s1">strargs </span><span class="s2">= [</span><span class="s1">os</span><span class="s2">.</span><span class="s1">fspath</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">args</span><span class="s2">]</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">optparser</span><span class="s2">.</span><span class="s1">parse_args</span><span class="s2">(</span><span class="s1">strargs</span><span class="s2">, </span><span class="s1">namespace</span><span class="s2">=</span><span class="s1">namespace</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">_getparser</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s3">&quot;MyOptionParser&quot;</span><span class="s2">:</span>
        <span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_argcomplete </span><span class="s0">import </span><span class="s1">filescompleter</span>

        <span class="s1">optparser </span><span class="s2">= </span><span class="s1">MyOptionParser</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">extra_info</span><span class="s2">, </span><span class="s1">prog</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">prog</span><span class="s2">)</span>
        <span class="s1">groups </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_groups </span><span class="s2">+ [</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_anonymous</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">group </span><span class="s0">in </span><span class="s1">groups</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">group</span><span class="s2">.</span><span class="s1">options</span><span class="s2">:</span>
                <span class="s1">desc </span><span class="s2">= </span><span class="s1">group</span><span class="s2">.</span><span class="s1">description </span><span class="s0">or </span><span class="s1">group</span><span class="s2">.</span><span class="s1">name</span>
                <span class="s1">arggroup </span><span class="s2">= </span><span class="s1">optparser</span><span class="s2">.</span><span class="s1">add_argument_group</span><span class="s2">(</span><span class="s1">desc</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">option </span><span class="s0">in </span><span class="s1">group</span><span class="s2">.</span><span class="s1">options</span><span class="s2">:</span>
                    <span class="s1">n </span><span class="s2">= </span><span class="s1">option</span><span class="s2">.</span><span class="s1">names</span><span class="s2">()</span>
                    <span class="s1">a </span><span class="s2">= </span><span class="s1">option</span><span class="s2">.</span><span class="s1">attrs</span><span class="s2">()</span>
                    <span class="s1">arggroup</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(*</span><span class="s1">n</span><span class="s2">, **</span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">file_or_dir_arg </span><span class="s2">= </span><span class="s1">optparser</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(</span><span class="s1">FILE_OR_DIR</span><span class="s2">, </span><span class="s1">nargs</span><span class="s2">=</span><span class="s3">&quot;*&quot;</span><span class="s2">)</span>
        <span class="s6"># bash like autocompletion for dirs (appending '/')</span>
        <span class="s6"># Type ignored because typeshed doesn't know about argcomplete.</span>
        <span class="s1">file_or_dir_arg</span><span class="s2">.</span><span class="s1">completer </span><span class="s2">= </span><span class="s1">filescompleter  </span><span class="s6"># type: ignore</span>
        <span class="s0">return </span><span class="s1">optparser</span>

    <span class="s0">def </span><span class="s1">parse_setoption</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">args</span><span class="s2">: </span><span class="s1">Sequence</span><span class="s2">[</span><span class="s1">Union</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s3">&quot;os.PathLike[str]&quot;</span><span class="s2">]],</span>
        <span class="s1">option</span><span class="s2">: </span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">,</span>
        <span class="s1">namespace</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">]:</span>
        <span class="s1">parsedoption </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">args</span><span class="s2">, </span><span class="s1">namespace</span><span class="s2">=</span><span class="s1">namespace</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">parsedoption</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">option</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">cast</span><span class="s2">(</span><span class="s1">List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">], </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">parsedoption</span><span class="s2">, </span><span class="s1">FILE_OR_DIR</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">parse_known_args</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">args</span><span class="s2">: </span><span class="s1">Sequence</span><span class="s2">[</span><span class="s1">Union</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s3">&quot;os.PathLike[str]&quot;</span><span class="s2">]],</span>
        <span class="s1">namespace</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">:</span>
        <span class="s4">&quot;&quot;&quot;Parse the known arguments at this point. 
 
        :returns: An argparse namespace object. 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parse_known_and_unknown_args</span><span class="s2">(</span><span class="s1">args</span><span class="s2">, </span><span class="s1">namespace</span><span class="s2">=</span><span class="s1">namespace</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">parse_known_and_unknown_args</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">args</span><span class="s2">: </span><span class="s1">Sequence</span><span class="s2">[</span><span class="s1">Union</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s3">&quot;os.PathLike[str]&quot;</span><span class="s2">]],</span>
        <span class="s1">namespace</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; Tuple</span><span class="s2">[</span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">, </span><span class="s1">List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">]]:</span>
        <span class="s4">&quot;&quot;&quot;Parse the known arguments at this point, and also return the 
        remaining unknown arguments. 
 
        :returns: 
            A tuple containing an argparse namespace object for the known 
            arguments, and a list of the unknown arguments. 
        &quot;&quot;&quot;</span>
        <span class="s1">optparser </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_getparser</span><span class="s2">()</span>
        <span class="s1">strargs </span><span class="s2">= [</span><span class="s1">os</span><span class="s2">.</span><span class="s1">fspath</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">args</span><span class="s2">]</span>
        <span class="s0">return </span><span class="s1">optparser</span><span class="s2">.</span><span class="s1">parse_known_args</span><span class="s2">(</span><span class="s1">strargs</span><span class="s2">, </span><span class="s1">namespace</span><span class="s2">=</span><span class="s1">namespace</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">addini</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
        <span class="s1">help</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
        <span class="s1">type</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span>
            <span class="s3">&quot;Literal['string', 'paths', 'pathlist', 'args', 'linelist', 'bool']&quot;</span>
        <span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">default</span><span class="s2">: </span><span class="s1">Any </span><span class="s2">= </span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s4">&quot;&quot;&quot;Register an ini-file option. 
 
        :param name: 
            Name of the ini-variable. 
        :param type: 
            Type of the variable. Can be: 
 
                * ``string``: a string 
                * ``bool``: a boolean 
                * ``args``: a list of strings, separated as in a shell 
                * ``linelist``: a list of strings, separated by line breaks 
                * ``paths``: a list of :class:`pathlib.Path`, separated as in a shell 
                * ``pathlist``: a list of ``py.path``, separated as in a shell 
 
            .. versionadded:: 7.0 
                The ``paths`` variable type. 
 
            Defaults to ``string`` if ``None`` or not passed. 
        :param default: 
            Default value if no ini-file option exists but is queried. 
 
        The value of ini-variables can be retrieved via a call to 
        :py:func:`config.getini(name) &lt;pytest.Config.getini&gt;`. 
        &quot;&quot;&quot;</span>
        <span class="s0">assert </span><span class="s1">type </span><span class="s0">in </span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;string&quot;</span><span class="s2">, </span><span class="s3">&quot;paths&quot;</span><span class="s2">, </span><span class="s3">&quot;pathlist&quot;</span><span class="s2">, </span><span class="s3">&quot;args&quot;</span><span class="s2">, </span><span class="s3">&quot;linelist&quot;</span><span class="s2">, </span><span class="s3">&quot;bool&quot;</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_inidict</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = (</span><span class="s1">help</span><span class="s2">, </span><span class="s1">type</span><span class="s2">, </span><span class="s1">default</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_ininames</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">ArgumentError</span><span class="s2">(</span><span class="s1">Exception</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Raised if an Argument instance is created with invalid or 
    inconsistent arguments.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">option</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span><span class="s3">&quot;Argument&quot;</span><span class="s2">, </span><span class="s1">str</span><span class="s2">]) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">msg </span><span class="s2">= </span><span class="s1">msg</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">option_id </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">option</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__str__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">option_id</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s3">f&quot;option </span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">option_id</span><span class="s0">}</span><span class="s3">: </span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">msg</span><span class="s0">}</span><span class="s3">&quot;</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">msg</span>


<span class="s0">class </span><span class="s1">Argument</span><span class="s2">:</span>
    <span class="s4">&quot;&quot;&quot;Class that mimics the necessary behaviour of optparse.Option. 
 
    It's currently a least effort implementation and ignoring choices 
    and integer prefixes. 
 
    https://docs.python.org/3/library/optparse.html#optparse-standard-option-types 
    &quot;&quot;&quot;</span>

    <span class="s1">_typ_map </span><span class="s2">= {</span><span class="s3">&quot;int&quot;</span><span class="s2">: </span><span class="s1">int</span><span class="s2">, </span><span class="s3">&quot;string&quot;</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s3">&quot;float&quot;</span><span class="s2">: </span><span class="s1">float</span><span class="s2">, </span><span class="s3">&quot;complex&quot;</span><span class="s2">: </span><span class="s1">complex</span><span class="s2">}</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">names</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, **</span><span class="s1">attrs</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s4">&quot;&quot;&quot;Store params in private vars for use in add_argument.&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_attrs </span><span class="s2">= </span><span class="s1">attrs</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_short_opts</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_long_opts</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = []</span>
        <span class="s0">if </span><span class="s3">&quot;%default&quot; </span><span class="s0">in </span><span class="s2">(</span><span class="s1">attrs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;help&quot;</span><span class="s2">) </span><span class="s0">or </span><span class="s3">&quot;&quot;</span><span class="s2">):</span>
            <span class="s1">warnings</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span><span class="s1">ARGUMENT_PERCENT_DEFAULT</span><span class="s2">, </span><span class="s1">stacklevel</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">typ </span><span class="s2">= </span><span class="s1">attrs</span><span class="s2">[</span><span class="s3">&quot;type&quot;</span><span class="s2">]</span>
        <span class="s0">except </span><span class="s1">KeyError</span><span class="s2">:</span>
            <span class="s0">pass</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s6"># This might raise a keyerror as well, don't want to catch that.</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">typ</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
                <span class="s0">if </span><span class="s1">typ </span><span class="s2">== </span><span class="s3">&quot;choice&quot;</span><span class="s2">:</span>
                    <span class="s1">warnings</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
                        <span class="s1">ARGUMENT_TYPE_STR_CHOICE</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">typ</span><span class="s2">=</span><span class="s1">typ</span><span class="s2">, </span><span class="s1">names</span><span class="s2">=</span><span class="s1">names</span><span class="s2">),</span>
                        <span class="s1">stacklevel</span><span class="s2">=</span><span class="s5">4</span><span class="s2">,</span>
                    <span class="s2">)</span>
                    <span class="s6"># argparse expects a type here take it from</span>
                    <span class="s6"># the type of the first element</span>
                    <span class="s1">attrs</span><span class="s2">[</span><span class="s3">&quot;type&quot;</span><span class="s2">] = </span><span class="s1">type</span><span class="s2">(</span><span class="s1">attrs</span><span class="s2">[</span><span class="s3">&quot;choices&quot;</span><span class="s2">][</span><span class="s5">0</span><span class="s2">])</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">warnings</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
                        <span class="s1">ARGUMENT_TYPE_STR</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">typ</span><span class="s2">=</span><span class="s1">typ</span><span class="s2">, </span><span class="s1">names</span><span class="s2">=</span><span class="s1">names</span><span class="s2">), </span><span class="s1">stacklevel</span><span class="s2">=</span><span class="s5">4</span>
                    <span class="s2">)</span>
                    <span class="s1">attrs</span><span class="s2">[</span><span class="s3">&quot;type&quot;</span><span class="s2">] = </span><span class="s1">Argument</span><span class="s2">.</span><span class="s1">_typ_map</span><span class="s2">[</span><span class="s1">typ</span><span class="s2">]</span>
                <span class="s6"># Used in test_parseopt -&gt; test_parse_defaultgetter.</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s1">attrs</span><span class="s2">[</span><span class="s3">&quot;type&quot;</span><span class="s2">]</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s1">typ</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s6"># Attribute existence is tested in Config._processopt.</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">default </span><span class="s2">= </span><span class="s1">attrs</span><span class="s2">[</span><span class="s3">&quot;default&quot;</span><span class="s2">]</span>
        <span class="s0">except </span><span class="s1">KeyError</span><span class="s2">:</span>
            <span class="s0">pass</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_set_opt_strings</span><span class="s2">(</span><span class="s1">names</span><span class="s2">)</span>
        <span class="s1">dest</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s1">attrs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;dest&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">dest</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">dest </span><span class="s2">= </span><span class="s1">dest</span>
        <span class="s0">elif </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_long_opts</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">dest </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_long_opts</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">2</span><span class="s2">:].</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">&quot;-&quot;</span><span class="s2">, </span><span class="s3">&quot;_&quot;</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">dest </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_short_opts</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">1</span><span class="s2">:]</span>
            <span class="s0">except </span><span class="s1">IndexError </span><span class="s0">as </span><span class="s1">e</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">dest </span><span class="s2">= </span><span class="s3">&quot;???&quot;  </span><span class="s6"># Needed for the error repr.</span>
                <span class="s0">raise </span><span class="s1">ArgumentError</span><span class="s2">(</span><span class="s3">&quot;need a long or short option&quot;</span><span class="s2">, </span><span class="s1">self</span><span class="s2">) </span><span class="s0">from </span><span class="s1">e</span>

    <span class="s0">def </span><span class="s1">names</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">]:</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_short_opts </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_long_opts</span>

    <span class="s0">def </span><span class="s1">attrs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Mapping</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]:</span>
        <span class="s6"># Update any attributes set by processopt.</span>
        <span class="s1">attrs </span><span class="s2">= </span><span class="s3">&quot;default dest help&quot;</span><span class="s2">.</span><span class="s1">split</span><span class="s2">()</span>
        <span class="s1">attrs</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dest</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">attr </span><span class="s0">in </span><span class="s1">attrs</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_attrs</span><span class="s2">[</span><span class="s1">attr</span><span class="s2">] = </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">attr</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
                <span class="s0">pass</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_attrs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">&quot;help&quot;</span><span class="s2">):</span>
            <span class="s1">a </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_attrs</span><span class="s2">[</span><span class="s3">&quot;help&quot;</span><span class="s2">]</span>
            <span class="s1">a </span><span class="s2">= </span><span class="s1">a</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">&quot;%default&quot;</span><span class="s2">, </span><span class="s3">&quot;%(default)s&quot;</span><span class="s2">)</span>
            <span class="s6"># a = a.replace('%prog', '%(prog)s')</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_attrs</span><span class="s2">[</span><span class="s3">&quot;help&quot;</span><span class="s2">] = </span><span class="s1">a</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_attrs</span>

    <span class="s0">def </span><span class="s1">_set_opt_strings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">opts</span><span class="s2">: </span><span class="s1">Sequence</span><span class="s2">[</span><span class="s1">str</span><span class="s2">]) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s4">&quot;&quot;&quot;Directly from optparse. 
 
        Might not be necessary as this is passed to argparse later on. 
        &quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">opt </span><span class="s0">in </span><span class="s1">opts</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">opt</span><span class="s2">) &lt; </span><span class="s5">2</span><span class="s2">:</span>
                <span class="s0">raise </span><span class="s1">ArgumentError</span><span class="s2">(</span>
                    <span class="s3">&quot;invalid option string %r: &quot;</span>
                    <span class="s3">&quot;must be at least two characters long&quot; </span><span class="s2">% </span><span class="s1">opt</span><span class="s2">,</span>
                    <span class="s1">self</span><span class="s2">,</span>
                <span class="s2">)</span>
            <span class="s0">elif </span><span class="s1">len</span><span class="s2">(</span><span class="s1">opt</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">:</span>
                <span class="s0">if not </span><span class="s2">(</span><span class="s1">opt</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s3">&quot;-&quot; </span><span class="s0">and </span><span class="s1">opt</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] != </span><span class="s3">&quot;-&quot;</span><span class="s2">):</span>
                    <span class="s0">raise </span><span class="s1">ArgumentError</span><span class="s2">(</span>
                        <span class="s3">&quot;invalid short option string %r: &quot;</span>
                        <span class="s3">&quot;must be of the form -x, (x any non-dash char)&quot; </span><span class="s2">% </span><span class="s1">opt</span><span class="s2">,</span>
                        <span class="s1">self</span><span class="s2">,</span>
                    <span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_short_opts</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">opt</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">if not </span><span class="s2">(</span><span class="s1">opt</span><span class="s2">[</span><span class="s5">0</span><span class="s2">:</span><span class="s5">2</span><span class="s2">] == </span><span class="s3">&quot;--&quot; </span><span class="s0">and </span><span class="s1">opt</span><span class="s2">[</span><span class="s5">2</span><span class="s2">] != </span><span class="s3">&quot;-&quot;</span><span class="s2">):</span>
                    <span class="s0">raise </span><span class="s1">ArgumentError</span><span class="s2">(</span>
                        <span class="s3">&quot;invalid long option string %r: &quot;</span>
                        <span class="s3">&quot;must start with --, followed by non-dash&quot; </span><span class="s2">% </span><span class="s1">opt</span><span class="s2">,</span>
                        <span class="s1">self</span><span class="s2">,</span>
                    <span class="s2">)</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_long_opts</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">opt</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s1">args</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = []</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_short_opts</span><span class="s2">:</span>
            <span class="s1">args </span><span class="s2">+= [</span><span class="s3">&quot;_short_opts: &quot; </span><span class="s2">+ </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_short_opts</span><span class="s2">)]</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_long_opts</span><span class="s2">:</span>
            <span class="s1">args </span><span class="s2">+= [</span><span class="s3">&quot;_long_opts: &quot; </span><span class="s2">+ </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_long_opts</span><span class="s2">)]</span>
        <span class="s1">args </span><span class="s2">+= [</span><span class="s3">&quot;dest: &quot; </span><span class="s2">+ </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dest</span><span class="s2">)]</span>
        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s3">&quot;type&quot;</span><span class="s2">):</span>
            <span class="s1">args </span><span class="s2">+= [</span><span class="s3">&quot;type: &quot; </span><span class="s2">+ </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)]</span>
        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s3">&quot;default&quot;</span><span class="s2">):</span>
            <span class="s1">args </span><span class="s2">+= [</span><span class="s3">&quot;default: &quot; </span><span class="s2">+ </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">default</span><span class="s2">)]</span>
        <span class="s0">return </span><span class="s3">&quot;Argument({})&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s3">&quot;, &quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">args</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">OptionGroup</span><span class="s2">:</span>
    <span class="s4">&quot;&quot;&quot;A group of options shown in its own section.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
        <span class="s1">description</span><span class="s2">: </span><span class="s1">str </span><span class="s2">= </span><span class="s3">&quot;&quot;</span><span class="s2">,</span>
        <span class="s1">parser</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Parser</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s2">*,</span>
        <span class="s1">_ispytest</span><span class="s2">: </span><span class="s1">bool </span><span class="s2">= </span><span class="s0">False</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">check_ispytest</span><span class="s2">(</span><span class="s1">_ispytest</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">description </span><span class="s2">= </span><span class="s1">description</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">options</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">Argument</span><span class="s2">] = []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">parser </span><span class="s2">= </span><span class="s1">parser</span>

    <span class="s0">def </span><span class="s1">addoption</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">opts</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, **</span><span class="s1">attrs</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s4">&quot;&quot;&quot;Add an option to this group. 
 
        If a shortened version of a long option is specified, it will 
        be suppressed in the help. ``addoption('--twowords', '--two-words')`` 
        results in help showing ``--two-words`` only, but ``--twowords`` gets 
        accepted **and** the automatic destination is in ``args.twowords``. 
 
        :param opts: 
            Option names, can be short or long options. 
        :param attrs: 
            Same attributes as the argparse library's :py:func:`add_argument() 
            &lt;argparse.ArgumentParser.add_argument&gt;` function accepts. 
        &quot;&quot;&quot;</span>
        <span class="s1">conflict </span><span class="s2">= </span><span class="s1">set</span><span class="s2">(</span><span class="s1">opts</span><span class="s2">).</span><span class="s1">intersection</span><span class="s2">(</span>
            <span class="s1">name </span><span class="s0">for </span><span class="s1">opt </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">options </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">opt</span><span class="s2">.</span><span class="s1">names</span><span class="s2">()</span>
        <span class="s2">)</span>
        <span class="s0">if </span><span class="s1">conflict</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s3">&quot;option names %s already added&quot; </span><span class="s2">% </span><span class="s1">conflict</span><span class="s2">)</span>
        <span class="s1">option </span><span class="s2">= </span><span class="s1">Argument</span><span class="s2">(*</span><span class="s1">opts</span><span class="s2">, **</span><span class="s1">attrs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_addoption_instance</span><span class="s2">(</span><span class="s1">option</span><span class="s2">, </span><span class="s1">shortupper</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">_addoption</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">opts</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, **</span><span class="s1">attrs</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">option </span><span class="s2">= </span><span class="s1">Argument</span><span class="s2">(*</span><span class="s1">opts</span><span class="s2">, **</span><span class="s1">attrs</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_addoption_instance</span><span class="s2">(</span><span class="s1">option</span><span class="s2">, </span><span class="s1">shortupper</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">_addoption_instance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">option</span><span class="s2">: </span><span class="s3">&quot;Argument&quot;</span><span class="s2">, </span><span class="s1">shortupper</span><span class="s2">: </span><span class="s1">bool </span><span class="s2">= </span><span class="s0">False</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s0">if not </span><span class="s1">shortupper</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">opt </span><span class="s0">in </span><span class="s1">option</span><span class="s2">.</span><span class="s1">_short_opts</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">opt</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s3">&quot;-&quot; </span><span class="s0">and </span><span class="s1">opt</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">islower</span><span class="s2">():</span>
                    <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s3">&quot;lowercase shortoptions reserved&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">processoption</span><span class="s2">(</span><span class="s1">option</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">option</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">MyOptionParser</span><span class="s2">(</span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">ArgumentParser</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">parser</span><span class="s2">: </span><span class="s1">Parser</span><span class="s2">,</span>
        <span class="s1">extra_info</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">prog</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_parser </span><span class="s2">= </span><span class="s1">parser</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">(</span>
            <span class="s1">prog</span><span class="s2">=</span><span class="s1">prog</span><span class="s2">,</span>
            <span class="s1">usage</span><span class="s2">=</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">_usage</span><span class="s2">,</span>
            <span class="s1">add_help</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
            <span class="s1">formatter_class</span><span class="s2">=</span><span class="s1">DropShorterLongHelpFormatter</span><span class="s2">,</span>
            <span class="s1">allow_abbrev</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s6"># extra_info is a dict of (param -&gt; value) to display if there's</span>
        <span class="s6"># an usage error to provide more contextual information to the user.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">extra_info </span><span class="s2">= </span><span class="s1">extra_info </span><span class="s0">if </span><span class="s1">extra_info </span><span class="s0">else </span><span class="s2">{}</span>

    <span class="s0">def </span><span class="s1">error</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">message</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; NoReturn</span><span class="s2">:</span>
        <span class="s4">&quot;&quot;&quot;Transform argparse error message into UsageError.&quot;&quot;&quot;</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">prog</span><span class="s0">}</span><span class="s3">: error: </span><span class="s0">{</span><span class="s1">message</span><span class="s0">}</span><span class="s3">&quot;</span>

        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_parser</span><span class="s2">, </span><span class="s3">&quot;_config_source_hint&quot;</span><span class="s2">):</span>
            <span class="s6"># Type ignored because the attribute is set dynamically.</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">msg</span><span class="s0">} </span><span class="s3">(</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_parser</span><span class="s2">.</span><span class="s1">_config_source_hint</span><span class="s0">}</span><span class="s3">)&quot;  </span><span class="s6"># type: ignore</span>

        <span class="s0">raise </span><span class="s1">UsageError</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">format_usage</span><span class="s2">() + </span><span class="s1">msg</span><span class="s2">)</span>

    <span class="s6"># Type ignored because typeshed has a very complex type in the superclass.</span>
    <span class="s0">def </span><span class="s1">parse_args</span><span class="s2">(  </span><span class="s6"># type: ignore</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">args</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Sequence</span><span class="s2">[</span><span class="s1">str</span><span class="s2">]] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">namespace</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">] = </span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; argparse</span><span class="s2">.</span><span class="s1">Namespace</span><span class="s2">:</span>
        <span class="s4">&quot;&quot;&quot;Allow splitting of positional arguments.&quot;&quot;&quot;</span>
        <span class="s1">parsed</span><span class="s2">, </span><span class="s1">unrecognized </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parse_known_args</span><span class="s2">(</span><span class="s1">args</span><span class="s2">, </span><span class="s1">namespace</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">unrecognized</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">arg </span><span class="s0">in </span><span class="s1">unrecognized</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">arg </span><span class="s0">and </span><span class="s1">arg</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s3">&quot;-&quot;</span><span class="s2">:</span>
                    <span class="s1">lines </span><span class="s2">= [</span><span class="s3">&quot;unrecognized arguments: %s&quot; </span><span class="s2">% (</span><span class="s3">&quot; &quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">unrecognized</span><span class="s2">))]</span>
                    <span class="s0">for </span><span class="s1">k</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">extra_info</span><span class="s2">.</span><span class="s1">items</span><span class="s2">()):</span>
                        <span class="s1">lines</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">f&quot;  </span><span class="s0">{</span><span class="s1">k</span><span class="s0">}</span><span class="s3">: </span><span class="s0">{</span><span class="s1">v</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">)</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">))</span>
            <span class="s1">getattr</span><span class="s2">(</span><span class="s1">parsed</span><span class="s2">, </span><span class="s1">FILE_OR_DIR</span><span class="s2">).</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">unrecognized</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">parsed</span>

    <span class="s0">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info</span><span class="s2">[:</span><span class="s5">2</span><span class="s2">] &lt; (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">9</span><span class="s2">):  </span><span class="s6"># pragma: no cover</span>
        <span class="s6"># Backport of https://github.com/python/cpython/pull/14316 so we can</span>
        <span class="s6"># disable long --argument abbreviations without breaking short flags.</span>
        <span class="s0">def </span><span class="s1">_parse_optional</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">, </span><span class="s1">arg_string</span><span class="s2">: </span><span class="s1">str</span>
        <span class="s2">) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">Action</span><span class="s2">], </span><span class="s1">str</span><span class="s2">, </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">]]]:</span>
            <span class="s0">if not </span><span class="s1">arg_string</span><span class="s2">:</span>
                <span class="s0">return None</span>
            <span class="s0">if not </span><span class="s1">arg_string</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">prefix_chars</span><span class="s2">:</span>
                <span class="s0">return None</span>
            <span class="s0">if </span><span class="s1">arg_string </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_option_string_actions</span><span class="s2">:</span>
                <span class="s1">action </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_option_string_actions</span><span class="s2">[</span><span class="s1">arg_string</span><span class="s2">]</span>
                <span class="s0">return </span><span class="s1">action</span><span class="s2">, </span><span class="s1">arg_string</span><span class="s2">, </span><span class="s0">None</span>
            <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg_string</span><span class="s2">) == </span><span class="s5">1</span><span class="s2">:</span>
                <span class="s0">return None</span>
            <span class="s0">if </span><span class="s3">&quot;=&quot; </span><span class="s0">in </span><span class="s1">arg_string</span><span class="s2">:</span>
                <span class="s1">option_string</span><span class="s2">, </span><span class="s1">explicit_arg </span><span class="s2">= </span><span class="s1">arg_string</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;=&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">option_string </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_option_string_actions</span><span class="s2">:</span>
                    <span class="s1">action </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_option_string_actions</span><span class="s2">[</span><span class="s1">option_string</span><span class="s2">]</span>
                    <span class="s0">return </span><span class="s1">action</span><span class="s2">, </span><span class="s1">option_string</span><span class="s2">, </span><span class="s1">explicit_arg</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">allow_abbrev </span><span class="s0">or not </span><span class="s1">arg_string</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">&quot;--&quot;</span><span class="s2">):</span>
                <span class="s1">option_tuples </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_get_option_tuples</span><span class="s2">(</span><span class="s1">arg_string</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">option_tuples</span><span class="s2">) &gt; </span><span class="s5">1</span><span class="s2">:</span>
                    <span class="s1">msg </span><span class="s2">= </span><span class="s1">gettext</span><span class="s2">(</span>
                        <span class="s3">&quot;ambiguous option: %(option)s could match %(matches)s&quot;</span>
                    <span class="s2">)</span>
                    <span class="s1">options </span><span class="s2">= </span><span class="s3">&quot;, &quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">option </span><span class="s0">for </span><span class="s1">_</span><span class="s2">, </span><span class="s1">option</span><span class="s2">, </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">option_tuples</span><span class="s2">)</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span><span class="s1">msg </span><span class="s2">% {</span><span class="s3">&quot;option&quot;</span><span class="s2">: </span><span class="s1">arg_string</span><span class="s2">, </span><span class="s3">&quot;matches&quot;</span><span class="s2">: </span><span class="s1">options</span><span class="s2">})</span>
                <span class="s0">elif </span><span class="s1">len</span><span class="s2">(</span><span class="s1">option_tuples</span><span class="s2">) == </span><span class="s5">1</span><span class="s2">:</span>
                    <span class="s2">(</span><span class="s1">option_tuple</span><span class="s2">,) = </span><span class="s1">option_tuples</span>
                    <span class="s0">return </span><span class="s1">option_tuple</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_negative_number_matcher</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s1">arg_string</span><span class="s2">):</span>
                <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_has_negative_number_optionals</span><span class="s2">:</span>
                    <span class="s0">return None</span>
            <span class="s0">if </span><span class="s3">&quot; &quot; </span><span class="s0">in </span><span class="s1">arg_string</span><span class="s2">:</span>
                <span class="s0">return None</span>
            <span class="s0">return None</span><span class="s2">, </span><span class="s1">arg_string</span><span class="s2">, </span><span class="s0">None</span>


<span class="s0">class </span><span class="s1">DropShorterLongHelpFormatter</span><span class="s2">(</span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">HelpFormatter</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Shorten help for long options that differ only in extra hyphens. 
 
    - Collapse **long** options that are the same except for extra hyphens. 
    - Shortcut if there are only two options and one of them is a short one. 
    - Cache result on the action object as this is called at least 2 times. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s6"># Use more accurate terminal width.</span>
        <span class="s0">if </span><span class="s3">&quot;width&quot; </span><span class="s0">not in </span><span class="s1">kwargs</span><span class="s2">:</span>
            <span class="s1">kwargs</span><span class="s2">[</span><span class="s3">&quot;width&quot;</span><span class="s2">] = </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_io</span><span class="s2">.</span><span class="s1">get_terminal_width</span><span class="s2">()</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">_format_action_invocation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">action</span><span class="s2">: </span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">Action</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s1">orgstr </span><span class="s2">= </span><span class="s1">super</span><span class="s2">().</span><span class="s1">_format_action_invocation</span><span class="s2">(</span><span class="s1">action</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">orgstr </span><span class="s0">and </span><span class="s1">orgstr</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] != </span><span class="s3">&quot;-&quot;</span><span class="s2">:  </span><span class="s6"># only optional arguments</span>
            <span class="s0">return </span><span class="s1">orgstr</span>
        <span class="s1">res</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">] = </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">action</span><span class="s2">, </span><span class="s3">&quot;_formatted_action_invocation&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">res</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">res</span>
        <span class="s1">options </span><span class="s2">= </span><span class="s1">orgstr</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;, &quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">options</span><span class="s2">) == </span><span class="s5">2 </span><span class="s0">and </span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">options</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) == </span><span class="s5">2 </span><span class="s0">or </span><span class="s1">len</span><span class="s2">(</span><span class="s1">options</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]) == </span><span class="s5">2</span><span class="s2">):</span>
            <span class="s6"># a shortcut for '-h, --help' or '--abc', '-a'</span>
            <span class="s1">action</span><span class="s2">.</span><span class="s1">_formatted_action_invocation </span><span class="s2">= </span><span class="s1">orgstr  </span><span class="s6"># type: ignore</span>
            <span class="s0">return </span><span class="s1">orgstr</span>
        <span class="s1">return_list </span><span class="s2">= []</span>
        <span class="s1">short_long</span><span class="s2">: </span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">str</span><span class="s2">] = {}</span>
        <span class="s0">for </span><span class="s1">option </span><span class="s0">in </span><span class="s1">options</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">option</span><span class="s2">) == </span><span class="s5">2 </span><span class="s0">or </span><span class="s1">option</span><span class="s2">[</span><span class="s5">2</span><span class="s2">] == </span><span class="s3">&quot; &quot;</span><span class="s2">:</span>
                <span class="s0">continue</span>
            <span class="s0">if not </span><span class="s1">option</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">&quot;--&quot;</span><span class="s2">):</span>
                <span class="s0">raise </span><span class="s1">ArgumentError</span><span class="s2">(</span>
                    <span class="s3">'long optional argument without &quot;--&quot;: [%s]' </span><span class="s2">% (</span><span class="s1">option</span><span class="s2">), </span><span class="s1">option</span>
                <span class="s2">)</span>
            <span class="s1">xxoption </span><span class="s2">= </span><span class="s1">option</span><span class="s2">[</span><span class="s5">2</span><span class="s2">:]</span>
            <span class="s1">shortened </span><span class="s2">= </span><span class="s1">xxoption</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">&quot;-&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">shortened </span><span class="s0">not in </span><span class="s1">short_long </span><span class="s0">or </span><span class="s1">len</span><span class="s2">(</span><span class="s1">short_long</span><span class="s2">[</span><span class="s1">shortened</span><span class="s2">]) &lt; </span><span class="s1">len</span><span class="s2">(</span>
                <span class="s1">xxoption</span>
            <span class="s2">):</span>
                <span class="s1">short_long</span><span class="s2">[</span><span class="s1">shortened</span><span class="s2">] = </span><span class="s1">xxoption</span>
        <span class="s6"># now short_long has been filled out to the longest with dashes</span>
        <span class="s6"># **and** we keep the right option ordering from add_argument</span>
        <span class="s0">for </span><span class="s1">option </span><span class="s0">in </span><span class="s1">options</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">option</span><span class="s2">) == </span><span class="s5">2 </span><span class="s0">or </span><span class="s1">option</span><span class="s2">[</span><span class="s5">2</span><span class="s2">] == </span><span class="s3">&quot; &quot;</span><span class="s2">:</span>
                <span class="s1">return_list</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">option</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">option</span><span class="s2">[</span><span class="s5">2</span><span class="s2">:] == </span><span class="s1">short_long</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">option</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">&quot;-&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">)):</span>
                <span class="s1">return_list</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">option</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s3">&quot; &quot;</span><span class="s2">, </span><span class="s3">&quot;=&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s1">formatted_action_invocation </span><span class="s2">= </span><span class="s3">&quot;, &quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">return_list</span><span class="s2">)</span>
        <span class="s1">action</span><span class="s2">.</span><span class="s1">_formatted_action_invocation </span><span class="s2">= </span><span class="s1">formatted_action_invocation  </span><span class="s6"># type: ignore</span>
        <span class="s0">return </span><span class="s1">formatted_action_invocation</span>

    <span class="s0">def </span><span class="s1">_split_lines</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">width</span><span class="s2">):</span>
        <span class="s4">&quot;&quot;&quot;Wrap lines after splitting on original newlines. 
 
        This allows to have explicit line breaks in the help text. 
        &quot;&quot;&quot;</span>
        <span class="s0">import </span><span class="s1">textwrap</span>

        <span class="s1">lines </span><span class="s2">= []</span>
        <span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">text</span><span class="s2">.</span><span class="s1">splitlines</span><span class="s2">():</span>
            <span class="s1">lines</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">textwrap</span><span class="s2">.</span><span class="s1">wrap</span><span class="s2">(</span><span class="s1">line</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">(), </span><span class="s1">width</span><span class="s2">))</span>
        <span class="s0">return </span><span class="s1">lines</span>
</pre>
</body>
</html>