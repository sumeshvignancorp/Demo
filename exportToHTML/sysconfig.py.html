<html>
<head>
<title>sysconfig.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
sysconfig.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Provide access to Python's configuration information.  The specific 
configuration variables available depend heavily on the platform and 
configuration.  The values may be retrieved using 
get_config_var(name), and the list of variables is available via 
get_config_vars().keys().  Additional convenience functions are also 
available. 
 
Written by:   Fred L. Drake, Jr. 
Email:        &lt;fdrake@acm.org&gt; 
&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">re</span>
<span class="s2">import </span><span class="s1">sys</span>
<span class="s2">import </span><span class="s1">sysconfig</span>
<span class="s2">import </span><span class="s1">pathlib</span>

<span class="s2">from </span><span class="s3">.</span><span class="s1">errors </span><span class="s2">import </span><span class="s1">DistutilsPlatformError</span>
<span class="s2">from </span><span class="s3">. </span><span class="s2">import </span><span class="s1">py39compat</span>
<span class="s2">from </span><span class="s3">.</span><span class="s1">_functools </span><span class="s2">import </span><span class="s1">pass_none</span>

<span class="s1">IS_PYPY </span><span class="s3">= </span><span class="s4">'__pypy__' </span><span class="s2">in </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">builtin_module_names</span>

<span class="s5"># These are needed in a couple of spots, so just compute them once.</span>
<span class="s1">PREFIX </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">normpath</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">prefix</span><span class="s3">)</span>
<span class="s1">EXEC_PREFIX </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">normpath</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">exec_prefix</span><span class="s3">)</span>
<span class="s1">BASE_PREFIX </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">normpath</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">base_prefix</span><span class="s3">)</span>
<span class="s1">BASE_EXEC_PREFIX </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">normpath</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">base_exec_prefix</span><span class="s3">)</span>

<span class="s5"># Path to the base directory of the project. On Windows the binary may</span>
<span class="s5"># live in project/PCbuild/win32 or project/PCbuild/amd64.</span>
<span class="s5"># set for cross builds</span>
<span class="s2">if </span><span class="s4">&quot;_PYTHON_PROJECT_BASE&quot; </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
    <span class="s1">project_base </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">abspath</span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">&quot;_PYTHON_PROJECT_BASE&quot;</span><span class="s3">])</span>
<span class="s2">else</span><span class="s3">:</span>
    <span class="s2">if </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">executable</span><span class="s3">:</span>
        <span class="s1">project_base </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">dirname</span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">abspath</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">executable</span><span class="s3">))</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s5"># sys.executable can be empty if argv[0] has been changed and Python is</span>
        <span class="s5"># unable to retrieve the real program name</span>
        <span class="s1">project_base </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">getcwd</span><span class="s3">()</span>


<span class="s2">def </span><span class="s1">_is_python_source_dir</span><span class="s3">(</span><span class="s1">d</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Return True if the target directory appears to point to an 
    un-installed Python. 
    &quot;&quot;&quot;</span>
    <span class="s1">modules </span><span class="s3">= </span><span class="s1">pathlib</span><span class="s3">.</span><span class="s1">Path</span><span class="s3">(</span><span class="s1">d</span><span class="s3">).</span><span class="s1">joinpath</span><span class="s3">(</span><span class="s4">'Modules'</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">any</span><span class="s3">(</span><span class="s1">modules</span><span class="s3">.</span><span class="s1">joinpath</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">).</span><span class="s1">is_file</span><span class="s3">() </span><span class="s2">for </span><span class="s1">fn </span><span class="s2">in </span><span class="s3">(</span><span class="s4">'Setup'</span><span class="s3">, </span><span class="s4">'Setup.local'</span><span class="s3">))</span>


<span class="s1">_sys_home </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">, </span><span class="s4">'_home'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_is_parent</span><span class="s3">(</span><span class="s1">dir_a</span><span class="s3">, </span><span class="s1">dir_b</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Return True if a is a parent of b. 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">normcase</span><span class="s3">(</span><span class="s1">dir_a</span><span class="s3">).</span><span class="s1">startswith</span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">normcase</span><span class="s3">(</span><span class="s1">dir_b</span><span class="s3">))</span>


<span class="s2">if </span><span class="s1">os</span><span class="s3">.</span><span class="s1">name </span><span class="s3">== </span><span class="s4">'nt'</span><span class="s3">:</span>

    <span class="s3">@</span><span class="s1">pass_none</span>
    <span class="s2">def </span><span class="s1">_fix_pcbuild</span><span class="s3">(</span><span class="s1">d</span><span class="s3">):</span>
        <span class="s5"># In a venv, sys._home will be inside BASE_PREFIX rather than PREFIX.</span>
        <span class="s1">prefixes </span><span class="s3">= </span><span class="s1">PREFIX</span><span class="s3">, </span><span class="s1">BASE_PREFIX</span>
        <span class="s1">matched </span><span class="s3">= (</span>
            <span class="s1">prefix</span>
            <span class="s2">for </span><span class="s1">prefix </span><span class="s2">in </span><span class="s1">prefixes</span>
            <span class="s2">if </span><span class="s1">_is_parent</span><span class="s3">(</span><span class="s1">d</span><span class="s3">, </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">&quot;PCbuild&quot;</span><span class="s3">))</span>
        <span class="s3">)</span>
        <span class="s2">return </span><span class="s1">next</span><span class="s3">(</span><span class="s1">matched</span><span class="s3">, </span><span class="s1">d</span><span class="s3">)</span>

    <span class="s1">project_base </span><span class="s3">= </span><span class="s1">_fix_pcbuild</span><span class="s3">(</span><span class="s1">project_base</span><span class="s3">)</span>
    <span class="s1">_sys_home </span><span class="s3">= </span><span class="s1">_fix_pcbuild</span><span class="s3">(</span><span class="s1">_sys_home</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_python_build</span><span class="s3">():</span>
    <span class="s2">if </span><span class="s1">_sys_home</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">_is_python_source_dir</span><span class="s3">(</span><span class="s1">_sys_home</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">_is_python_source_dir</span><span class="s3">(</span><span class="s1">project_base</span><span class="s3">)</span>


<span class="s1">python_build </span><span class="s3">= </span><span class="s1">_python_build</span><span class="s3">()</span>


<span class="s5"># Calculate the build qualifier flags if they are defined.  Adding the flags</span>
<span class="s5"># to the include and lib directories only makes sense for an installation, not</span>
<span class="s5"># an in-source build.</span>
<span class="s1">build_flags </span><span class="s3">= </span><span class="s4">''</span>
<span class="s2">try</span><span class="s3">:</span>
    <span class="s2">if not </span><span class="s1">python_build</span><span class="s3">:</span>
        <span class="s1">build_flags </span><span class="s3">= </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">abiflags</span>
<span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
    <span class="s5"># It's not a configure-based build, so the sys module doesn't have</span>
    <span class="s5"># this attribute, which is fine.</span>
    <span class="s2">pass</span>


<span class="s2">def </span><span class="s1">get_python_version</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot;Return a string containing the major and minor Python version, 
    leaving off the patchlevel.  Sample return values could be '1.5' 
    or '2.2'. 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s4">'%d.%d' </span><span class="s3">% </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">version_info</span><span class="s3">[:</span><span class="s6">2</span><span class="s3">]</span>


<span class="s2">def </span><span class="s1">get_python_inc</span><span class="s3">(</span><span class="s1">plat_specific</span><span class="s3">=</span><span class="s6">0</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Return the directory containing installed Python header files. 
 
    If 'plat_specific' is false (the default), this is the path to the 
    non-platform-specific header files, i.e. Python.h and so on; 
    otherwise, this is the path to platform-specific header files 
    (namely pyconfig.h). 
 
    If 'prefix' is supplied, use it instead of sys.base_prefix or 
    sys.base_exec_prefix -- i.e., ignore 'plat_specific'. 
    &quot;&quot;&quot;</span>
    <span class="s1">default_prefix </span><span class="s3">= </span><span class="s1">BASE_EXEC_PREFIX </span><span class="s2">if </span><span class="s1">plat_specific </span><span class="s2">else </span><span class="s1">BASE_PREFIX</span>
    <span class="s1">resolved_prefix </span><span class="s3">= </span><span class="s1">prefix </span><span class="s2">if </span><span class="s1">prefix </span><span class="s2">is not None else </span><span class="s1">default_prefix</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s1">getter </span><span class="s3">= </span><span class="s1">globals</span><span class="s3">()[</span><span class="s4">f'_get_python_inc_</span><span class="s2">{</span><span class="s1">os</span><span class="s3">.</span><span class="s1">name</span><span class="s2">}</span><span class="s4">'</span><span class="s3">]</span>
    <span class="s2">except </span><span class="s1">KeyError</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">DistutilsPlatformError</span><span class="s3">(</span>
            <span class="s4">&quot;I don't know where Python installs its C header files &quot;</span>
            <span class="s4">&quot;on platform '%s'&quot; </span><span class="s3">% </span><span class="s1">os</span><span class="s3">.</span><span class="s1">name</span>
        <span class="s3">)</span>
    <span class="s2">return </span><span class="s1">getter</span><span class="s3">(</span><span class="s1">resolved_prefix</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">, </span><span class="s1">plat_specific</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_get_python_inc_posix</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s1">spec_prefix</span><span class="s3">, </span><span class="s1">plat_specific</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">IS_PYPY </span><span class="s2">and </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">version_info </span><span class="s3">&lt; (</span><span class="s6">3</span><span class="s3">, </span><span class="s6">8</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">'include'</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s3">(</span>
        <span class="s1">_get_python_inc_posix_python</span><span class="s3">(</span><span class="s1">plat_specific</span><span class="s3">)</span>
        <span class="s2">or </span><span class="s1">_get_python_inc_from_config</span><span class="s3">(</span><span class="s1">plat_specific</span><span class="s3">, </span><span class="s1">spec_prefix</span><span class="s3">)</span>
        <span class="s2">or </span><span class="s1">_get_python_inc_posix_prefix</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">)</span>
    <span class="s3">)</span>


<span class="s2">def </span><span class="s1">_get_python_inc_posix_python</span><span class="s3">(</span><span class="s1">plat_specific</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Assume the executable is in the build directory. The 
    pyconfig.h file should be in the same directory. Since 
    the build directory may not be the source directory, 
    use &quot;srcdir&quot; from the makefile to find the &quot;Include&quot; 
    directory. 
    &quot;&quot;&quot;</span>
    <span class="s2">if not </span><span class="s1">python_build</span><span class="s3">:</span>
        <span class="s2">return</span>
    <span class="s2">if </span><span class="s1">plat_specific</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">_sys_home </span><span class="s2">or </span><span class="s1">project_base</span>
    <span class="s1">incdir </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">get_config_var</span><span class="s3">(</span><span class="s4">'srcdir'</span><span class="s3">), </span><span class="s4">'Include'</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">normpath</span><span class="s3">(</span><span class="s1">incdir</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_get_python_inc_from_config</span><span class="s3">(</span><span class="s1">plat_specific</span><span class="s3">, </span><span class="s1">spec_prefix</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    If no prefix was explicitly specified, provide the include 
    directory from the config vars. Useful when 
    cross-compiling, since the config vars may come from 
    the host 
    platform Python installation, while the current Python 
    executable is from the build platform installation. 
 
    &gt;&gt;&gt; monkeypatch = getfixture('monkeypatch') 
    &gt;&gt;&gt; gpifc = _get_python_inc_from_config 
    &gt;&gt;&gt; monkeypatch.setitem(gpifc.__globals__, 'get_config_var', str.lower) 
    &gt;&gt;&gt; gpifc(False, '/usr/bin/') 
    &gt;&gt;&gt; gpifc(False, '') 
    &gt;&gt;&gt; gpifc(False, None) 
    'includepy' 
    &gt;&gt;&gt; gpifc(True, None) 
    'confincludepy' 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">spec_prefix </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">get_config_var</span><span class="s3">(</span><span class="s4">'CONF' </span><span class="s3">* </span><span class="s1">plat_specific </span><span class="s3">+ </span><span class="s4">'INCLUDEPY'</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_get_python_inc_posix_prefix</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">):</span>
    <span class="s1">implementation </span><span class="s3">= </span><span class="s4">'pypy' </span><span class="s2">if </span><span class="s1">IS_PYPY </span><span class="s2">else </span><span class="s4">'python'</span>
    <span class="s1">python_dir </span><span class="s3">= </span><span class="s1">implementation </span><span class="s3">+ </span><span class="s1">get_python_version</span><span class="s3">() + </span><span class="s1">build_flags</span>
    <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">&quot;include&quot;</span><span class="s3">, </span><span class="s1">python_dir</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_get_python_inc_nt</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s1">spec_prefix</span><span class="s3">, </span><span class="s1">plat_specific</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">python_build</span><span class="s3">:</span>
        <span class="s5"># Include both the include and PC dir to ensure we can find</span>
        <span class="s5"># pyconfig.h</span>
        <span class="s2">return </span><span class="s3">(</span>
            <span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">&quot;include&quot;</span><span class="s3">)</span>
            <span class="s3">+ </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">pathsep</span>
            <span class="s3">+ </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">&quot;PC&quot;</span><span class="s3">)</span>
        <span class="s3">)</span>
    <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">&quot;include&quot;</span><span class="s3">)</span>


<span class="s5"># allow this behavior to be monkey-patched. Ref pypa/distutils#2.</span>
<span class="s2">def </span><span class="s1">_posix_lib</span><span class="s3">(</span><span class="s1">standard_lib</span><span class="s3">, </span><span class="s1">libpython</span><span class="s3">, </span><span class="s1">early_prefix</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">standard_lib</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">libpython</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">libpython</span><span class="s3">, </span><span class="s4">&quot;site-packages&quot;</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">get_python_lib</span><span class="s3">(</span><span class="s1">plat_specific</span><span class="s3">=</span><span class="s6">0</span><span class="s3">, </span><span class="s1">standard_lib</span><span class="s3">=</span><span class="s6">0</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Return the directory containing the Python library (standard or 
    site additions). 
 
    If 'plat_specific' is true, return the directory containing 
    platform-specific modules, i.e. any module from a non-pure-Python 
    module distribution; otherwise, return the platform-shared library 
    directory.  If 'standard_lib' is true, return the directory 
    containing standard Python library modules; otherwise, return the 
    directory for site-specific modules. 
 
    If 'prefix' is supplied, use it instead of sys.base_prefix or 
    sys.base_exec_prefix -- i.e., ignore 'plat_specific'. 
    &quot;&quot;&quot;</span>

    <span class="s2">if </span><span class="s1">IS_PYPY </span><span class="s2">and </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">version_info </span><span class="s3">&lt; (</span><span class="s6">3</span><span class="s3">, </span><span class="s6">8</span><span class="s3">):</span>
        <span class="s5"># PyPy-specific schema</span>
        <span class="s2">if </span><span class="s1">prefix </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">prefix </span><span class="s3">= </span><span class="s1">PREFIX</span>
        <span class="s2">if </span><span class="s1">standard_lib</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">&quot;lib-python&quot;</span><span class="s3">, </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">version</span><span class="s3">[</span><span class="s6">0</span><span class="s3">])</span>
        <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">'site-packages'</span><span class="s3">)</span>

    <span class="s1">early_prefix </span><span class="s3">= </span><span class="s1">prefix</span>

    <span class="s2">if </span><span class="s1">prefix </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">standard_lib</span><span class="s3">:</span>
            <span class="s1">prefix </span><span class="s3">= </span><span class="s1">plat_specific </span><span class="s2">and </span><span class="s1">BASE_EXEC_PREFIX </span><span class="s2">or </span><span class="s1">BASE_PREFIX</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">prefix </span><span class="s3">= </span><span class="s1">plat_specific </span><span class="s2">and </span><span class="s1">EXEC_PREFIX </span><span class="s2">or </span><span class="s1">PREFIX</span>

    <span class="s2">if </span><span class="s1">os</span><span class="s3">.</span><span class="s1">name </span><span class="s3">== </span><span class="s4">&quot;posix&quot;</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">plat_specific </span><span class="s2">or </span><span class="s1">standard_lib</span><span class="s3">:</span>
            <span class="s5"># Platform-specific modules (any module from a non-pure-Python</span>
            <span class="s5"># module distribution) or standard Python library modules.</span>
            <span class="s1">libdir </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">sys</span><span class="s3">, </span><span class="s4">&quot;platlibdir&quot;</span><span class="s3">, </span><span class="s4">&quot;lib&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s5"># Pure Python</span>
            <span class="s1">libdir </span><span class="s3">= </span><span class="s4">&quot;lib&quot;</span>
        <span class="s1">implementation </span><span class="s3">= </span><span class="s4">'pypy' </span><span class="s2">if </span><span class="s1">IS_PYPY </span><span class="s2">else </span><span class="s4">'python'</span>
        <span class="s1">libpython </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s1">libdir</span><span class="s3">, </span><span class="s1">implementation </span><span class="s3">+ </span><span class="s1">get_python_version</span><span class="s3">())</span>
        <span class="s2">return </span><span class="s1">_posix_lib</span><span class="s3">(</span><span class="s1">standard_lib</span><span class="s3">, </span><span class="s1">libpython</span><span class="s3">, </span><span class="s1">early_prefix</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">os</span><span class="s3">.</span><span class="s1">name </span><span class="s3">== </span><span class="s4">&quot;nt&quot;</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">standard_lib</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">&quot;Lib&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s4">&quot;Lib&quot;</span><span class="s3">, </span><span class="s4">&quot;site-packages&quot;</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">DistutilsPlatformError</span><span class="s3">(</span>
            <span class="s4">&quot;I don't know where Python installs its library &quot;</span>
            <span class="s4">&quot;on platform '%s'&quot; </span><span class="s3">% </span><span class="s1">os</span><span class="s3">.</span><span class="s1">name</span>
        <span class="s3">)</span>


<span class="s2">def </span><span class="s1">customize_compiler</span><span class="s3">(</span><span class="s1">compiler</span><span class="s3">):  </span><span class="s5"># noqa: C901</span>
    <span class="s0">&quot;&quot;&quot;Do any platform-specific customization of a CCompiler instance. 
 
    Mainly needed on Unix, so we can plug in the information that 
    varies across Unices and is stored in Python's Makefile. 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">compiler</span><span class="s3">.</span><span class="s1">compiler_type </span><span class="s3">== </span><span class="s4">&quot;unix&quot;</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">sys</span><span class="s3">.</span><span class="s1">platform </span><span class="s3">== </span><span class="s4">&quot;darwin&quot;</span><span class="s3">:</span>
            <span class="s5"># Perform first-time customization of compiler-related</span>
            <span class="s5"># config vars on OS X now that we know we need a compiler.</span>
            <span class="s5"># This is primarily to support Pythons from binary</span>
            <span class="s5"># installers.  The kind and paths to build tools on</span>
            <span class="s5"># the user system may vary significantly from the system</span>
            <span class="s5"># that Python itself was built on.  Also the user OS</span>
            <span class="s5"># version and build tools may not support the same set</span>
            <span class="s5"># of CPU architectures for universal builds.</span>
            <span class="s2">global </span><span class="s1">_config_vars</span>
            <span class="s5"># Use get_config_var() to ensure _config_vars is initialized.</span>
            <span class="s2">if not </span><span class="s1">get_config_var</span><span class="s3">(</span><span class="s4">'CUSTOMIZED_OSX_COMPILER'</span><span class="s3">):</span>
                <span class="s2">import </span><span class="s1">_osx_support</span>

                <span class="s1">_osx_support</span><span class="s3">.</span><span class="s1">customize_compiler</span><span class="s3">(</span><span class="s1">_config_vars</span><span class="s3">)</span>
                <span class="s1">_config_vars</span><span class="s3">[</span><span class="s4">'CUSTOMIZED_OSX_COMPILER'</span><span class="s3">] = </span><span class="s4">'True'</span>

        <span class="s3">(</span>
            <span class="s1">cc</span><span class="s3">,</span>
            <span class="s1">cxx</span><span class="s3">,</span>
            <span class="s1">cflags</span><span class="s3">,</span>
            <span class="s1">ccshared</span><span class="s3">,</span>
            <span class="s1">ldshared</span><span class="s3">,</span>
            <span class="s1">shlib_suffix</span><span class="s3">,</span>
            <span class="s1">ar</span><span class="s3">,</span>
            <span class="s1">ar_flags</span><span class="s3">,</span>
        <span class="s3">) = </span><span class="s1">get_config_vars</span><span class="s3">(</span>
            <span class="s4">'CC'</span><span class="s3">,</span>
            <span class="s4">'CXX'</span><span class="s3">,</span>
            <span class="s4">'CFLAGS'</span><span class="s3">,</span>
            <span class="s4">'CCSHARED'</span><span class="s3">,</span>
            <span class="s4">'LDSHARED'</span><span class="s3">,</span>
            <span class="s4">'SHLIB_SUFFIX'</span><span class="s3">,</span>
            <span class="s4">'AR'</span><span class="s3">,</span>
            <span class="s4">'ARFLAGS'</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s2">if </span><span class="s4">'CC' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
            <span class="s1">newcc </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'CC'</span><span class="s3">]</span>
            <span class="s2">if </span><span class="s4">'LDSHARED' </span><span class="s2">not in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ </span><span class="s2">and </span><span class="s1">ldshared</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">):</span>
                <span class="s5"># If CC is overridden, use that as the default</span>
                <span class="s5">#       command for LDSHARED as well</span>
                <span class="s1">ldshared </span><span class="s3">= </span><span class="s1">newcc </span><span class="s3">+ </span><span class="s1">ldshared</span><span class="s3">[</span><span class="s1">len</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">) :]</span>
            <span class="s1">cc </span><span class="s3">= </span><span class="s1">newcc</span>
        <span class="s2">if </span><span class="s4">'CXX' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
            <span class="s1">cxx </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'CXX'</span><span class="s3">]</span>
        <span class="s2">if </span><span class="s4">'LDSHARED' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
            <span class="s1">ldshared </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'LDSHARED'</span><span class="s3">]</span>
        <span class="s2">if </span><span class="s4">'CPP' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
            <span class="s1">cpp </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'CPP'</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">cpp </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">+ </span><span class="s4">&quot; -E&quot;  </span><span class="s5"># not always</span>
        <span class="s2">if </span><span class="s4">'LDFLAGS' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
            <span class="s1">ldshared </span><span class="s3">= </span><span class="s1">ldshared </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'LDFLAGS'</span><span class="s3">]</span>
        <span class="s2">if </span><span class="s4">'CFLAGS' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
            <span class="s1">cflags </span><span class="s3">= </span><span class="s1">cflags </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'CFLAGS'</span><span class="s3">]</span>
            <span class="s1">ldshared </span><span class="s3">= </span><span class="s1">ldshared </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'CFLAGS'</span><span class="s3">]</span>
        <span class="s2">if </span><span class="s4">'CPPFLAGS' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
            <span class="s1">cpp </span><span class="s3">= </span><span class="s1">cpp </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'CPPFLAGS'</span><span class="s3">]</span>
            <span class="s1">cflags </span><span class="s3">= </span><span class="s1">cflags </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'CPPFLAGS'</span><span class="s3">]</span>
            <span class="s1">ldshared </span><span class="s3">= </span><span class="s1">ldshared </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'CPPFLAGS'</span><span class="s3">]</span>
        <span class="s2">if </span><span class="s4">'AR' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
            <span class="s1">ar </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'AR'</span><span class="s3">]</span>
        <span class="s2">if </span><span class="s4">'ARFLAGS' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
            <span class="s1">archiver </span><span class="s3">= </span><span class="s1">ar </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'ARFLAGS'</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">archiver </span><span class="s3">= </span><span class="s1">ar </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">ar_flags</span>

        <span class="s1">cc_cmd </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">cflags</span>
        <span class="s1">compiler</span><span class="s3">.</span><span class="s1">set_executables</span><span class="s3">(</span>
            <span class="s1">preprocessor</span><span class="s3">=</span><span class="s1">cpp</span><span class="s3">,</span>
            <span class="s1">compiler</span><span class="s3">=</span><span class="s1">cc_cmd</span><span class="s3">,</span>
            <span class="s1">compiler_so</span><span class="s3">=</span><span class="s1">cc_cmd </span><span class="s3">+ </span><span class="s4">' ' </span><span class="s3">+ </span><span class="s1">ccshared</span><span class="s3">,</span>
            <span class="s1">compiler_cxx</span><span class="s3">=</span><span class="s1">cxx</span><span class="s3">,</span>
            <span class="s1">linker_so</span><span class="s3">=</span><span class="s1">ldshared</span><span class="s3">,</span>
            <span class="s1">linker_exe</span><span class="s3">=</span><span class="s1">cc</span><span class="s3">,</span>
            <span class="s1">archiver</span><span class="s3">=</span><span class="s1">archiver</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s2">if </span><span class="s4">'RANLIB' </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ </span><span class="s2">and </span><span class="s1">compiler</span><span class="s3">.</span><span class="s1">executables</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">'ranlib'</span><span class="s3">, </span><span class="s2">None</span><span class="s3">):</span>
            <span class="s1">compiler</span><span class="s3">.</span><span class="s1">set_executables</span><span class="s3">(</span><span class="s1">ranlib</span><span class="s3">=</span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s4">'RANLIB'</span><span class="s3">])</span>

        <span class="s1">compiler</span><span class="s3">.</span><span class="s1">shared_lib_extension </span><span class="s3">= </span><span class="s1">shlib_suffix</span>


<span class="s2">def </span><span class="s1">get_config_h_filename</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot;Return full pathname of installed pyconfig.h file.&quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">python_build</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">os</span><span class="s3">.</span><span class="s1">name </span><span class="s3">== </span><span class="s4">&quot;nt&quot;</span><span class="s3">:</span>
            <span class="s1">inc_dir </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">_sys_home </span><span class="s2">or </span><span class="s1">project_base</span><span class="s3">, </span><span class="s4">&quot;PC&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">inc_dir </span><span class="s3">= </span><span class="s1">_sys_home </span><span class="s2">or </span><span class="s1">project_base</span>
        <span class="s2">return </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">inc_dir</span><span class="s3">, </span><span class="s4">'pyconfig.h'</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">sysconfig</span><span class="s3">.</span><span class="s1">get_config_h_filename</span><span class="s3">()</span>


<span class="s2">def </span><span class="s1">get_makefile_filename</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot;Return full pathname of installed Makefile from the Python build.&quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">sysconfig</span><span class="s3">.</span><span class="s1">get_makefile_filename</span><span class="s3">()</span>


<span class="s2">def </span><span class="s1">parse_config_h</span><span class="s3">(</span><span class="s1">fp</span><span class="s3">, </span><span class="s1">g</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Parse a config.h-style file. 
 
    A dictionary containing name/value pairs is returned.  If an 
    optional dictionary is passed in as the second argument, it is 
    used instead of a new dictionary. 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">sysconfig</span><span class="s3">.</span><span class="s1">parse_config_h</span><span class="s3">(</span><span class="s1">fp</span><span class="s3">, </span><span class="s1">vars</span><span class="s3">=</span><span class="s1">g</span><span class="s3">)</span>


<span class="s5"># Regexes needed for parsing Makefile (and similar syntaxes,</span>
<span class="s5"># like old-style Setup files).</span>
<span class="s1">_variable_rx </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">compile</span><span class="s3">(</span><span class="s4">r&quot;([a-zA-Z][a-zA-Z0-9_]+)\s*=\s*(.*)&quot;</span><span class="s3">)</span>
<span class="s1">_findvar1_rx </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">compile</span><span class="s3">(</span><span class="s4">r&quot;\$\(([A-Za-z][A-Za-z0-9_]*)\)&quot;</span><span class="s3">)</span>
<span class="s1">_findvar2_rx </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">compile</span><span class="s3">(</span><span class="s4">r&quot;\${([A-Za-z][A-Za-z0-9_]*)}&quot;</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">parse_makefile</span><span class="s3">(</span><span class="s1">fn</span><span class="s3">, </span><span class="s1">g</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):  </span><span class="s5"># noqa: C901</span>
    <span class="s0">&quot;&quot;&quot;Parse a Makefile-style file. 
 
    A dictionary containing name/value pairs is returned.  If an 
    optional dictionary is passed in as the second argument, it is 
    used instead of a new dictionary. 
    &quot;&quot;&quot;</span>
    <span class="s2">from </span><span class="s1">distutils</span><span class="s3">.</span><span class="s1">text_file </span><span class="s2">import </span><span class="s1">TextFile</span>

    <span class="s1">fp </span><span class="s3">= </span><span class="s1">TextFile</span><span class="s3">(</span>
        <span class="s1">fn</span><span class="s3">, </span><span class="s1">strip_comments</span><span class="s3">=</span><span class="s6">1</span><span class="s3">, </span><span class="s1">skip_blanks</span><span class="s3">=</span><span class="s6">1</span><span class="s3">, </span><span class="s1">join_lines</span><span class="s3">=</span><span class="s6">1</span><span class="s3">, </span><span class="s1">errors</span><span class="s3">=</span><span class="s4">&quot;surrogateescape&quot;</span>
    <span class="s3">)</span>

    <span class="s2">if </span><span class="s1">g </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">g </span><span class="s3">= {}</span>
    <span class="s1">done </span><span class="s3">= {}</span>
    <span class="s1">notdone </span><span class="s3">= {}</span>

    <span class="s2">while True</span><span class="s3">:</span>
        <span class="s1">line </span><span class="s3">= </span><span class="s1">fp</span><span class="s3">.</span><span class="s1">readline</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s1">line </span><span class="s2">is None</span><span class="s3">:  </span><span class="s5"># eof</span>
            <span class="s2">break</span>
        <span class="s1">m </span><span class="s3">= </span><span class="s1">_variable_rx</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">line</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">m</span><span class="s3">:</span>
            <span class="s1">n</span><span class="s3">, </span><span class="s1">v </span><span class="s3">= </span><span class="s1">m</span><span class="s3">.</span><span class="s1">group</span><span class="s3">(</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">)</span>
            <span class="s1">v </span><span class="s3">= </span><span class="s1">v</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>
            <span class="s5"># `$$' is a literal `$' in make</span>
            <span class="s1">tmpv </span><span class="s3">= </span><span class="s1">v</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">'$$'</span><span class="s3">, </span><span class="s4">''</span><span class="s3">)</span>

            <span class="s2">if </span><span class="s4">&quot;$&quot; </span><span class="s2">in </span><span class="s1">tmpv</span><span class="s3">:</span>
                <span class="s1">notdone</span><span class="s3">[</span><span class="s1">n</span><span class="s3">] = </span><span class="s1">v</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s2">try</span><span class="s3">:</span>
                    <span class="s1">v </span><span class="s3">= </span><span class="s1">int</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)</span>
                <span class="s2">except </span><span class="s1">ValueError</span><span class="s3">:</span>
                    <span class="s5"># insert literal `$'</span>
                    <span class="s1">done</span><span class="s3">[</span><span class="s1">n</span><span class="s3">] = </span><span class="s1">v</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">'$$'</span><span class="s3">, </span><span class="s4">'$'</span><span class="s3">)</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s1">done</span><span class="s3">[</span><span class="s1">n</span><span class="s3">] = </span><span class="s1">v</span>

    <span class="s5"># Variables with a 'PY_' prefix in the makefile. These need to</span>
    <span class="s5"># be made available without that prefix through sysconfig.</span>
    <span class="s5"># Special care is needed to ensure that variable expansion works, even</span>
    <span class="s5"># if the expansion uses the name without a prefix.</span>
    <span class="s1">renamed_variables </span><span class="s3">= (</span><span class="s4">'CFLAGS'</span><span class="s3">, </span><span class="s4">'LDFLAGS'</span><span class="s3">, </span><span class="s4">'CPPFLAGS'</span><span class="s3">)</span>

    <span class="s5"># do variable interpolation here</span>
    <span class="s2">while </span><span class="s1">notdone</span><span class="s3">:</span>
        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">list</span><span class="s3">(</span><span class="s1">notdone</span><span class="s3">):</span>
            <span class="s1">value </span><span class="s3">= </span><span class="s1">notdone</span><span class="s3">[</span><span class="s1">name</span><span class="s3">]</span>
            <span class="s1">m </span><span class="s3">= </span><span class="s1">_findvar1_rx</span><span class="s3">.</span><span class="s1">search</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) </span><span class="s2">or </span><span class="s1">_findvar2_rx</span><span class="s3">.</span><span class="s1">search</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">m</span><span class="s3">:</span>
                <span class="s1">n </span><span class="s3">= </span><span class="s1">m</span><span class="s3">.</span><span class="s1">group</span><span class="s3">(</span><span class="s6">1</span><span class="s3">)</span>
                <span class="s1">found </span><span class="s3">= </span><span class="s2">True</span>
                <span class="s2">if </span><span class="s1">n </span><span class="s2">in </span><span class="s1">done</span><span class="s3">:</span>
                    <span class="s1">item </span><span class="s3">= </span><span class="s1">str</span><span class="s3">(</span><span class="s1">done</span><span class="s3">[</span><span class="s1">n</span><span class="s3">])</span>
                <span class="s2">elif </span><span class="s1">n </span><span class="s2">in </span><span class="s1">notdone</span><span class="s3">:</span>
                    <span class="s5"># get it on a subsequent round</span>
                    <span class="s1">found </span><span class="s3">= </span><span class="s2">False</span>
                <span class="s2">elif </span><span class="s1">n </span><span class="s2">in </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">:</span>
                    <span class="s5"># do it like make: fall back to environment</span>
                    <span class="s1">item </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">environ</span><span class="s3">[</span><span class="s1">n</span><span class="s3">]</span>

                <span class="s2">elif </span><span class="s1">n </span><span class="s2">in </span><span class="s1">renamed_variables</span><span class="s3">:</span>
                    <span class="s2">if </span><span class="s1">name</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">'PY_'</span><span class="s3">) </span><span class="s2">and </span><span class="s1">name</span><span class="s3">[</span><span class="s6">3</span><span class="s3">:] </span><span class="s2">in </span><span class="s1">renamed_variables</span><span class="s3">:</span>
                        <span class="s1">item </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>

                    <span class="s2">elif </span><span class="s4">'PY_' </span><span class="s3">+ </span><span class="s1">n </span><span class="s2">in </span><span class="s1">notdone</span><span class="s3">:</span>
                        <span class="s1">found </span><span class="s3">= </span><span class="s2">False</span>

                    <span class="s2">else</span><span class="s3">:</span>
                        <span class="s1">item </span><span class="s3">= </span><span class="s1">str</span><span class="s3">(</span><span class="s1">done</span><span class="s3">[</span><span class="s4">'PY_' </span><span class="s3">+ </span><span class="s1">n</span><span class="s3">])</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s1">done</span><span class="s3">[</span><span class="s1">n</span><span class="s3">] = </span><span class="s1">item </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
                <span class="s2">if </span><span class="s1">found</span><span class="s3">:</span>
                    <span class="s1">after </span><span class="s3">= </span><span class="s1">value</span><span class="s3">[</span><span class="s1">m</span><span class="s3">.</span><span class="s1">end</span><span class="s3">() :]</span>
                    <span class="s1">value </span><span class="s3">= </span><span class="s1">value</span><span class="s3">[: </span><span class="s1">m</span><span class="s3">.</span><span class="s1">start</span><span class="s3">()] + </span><span class="s1">item </span><span class="s3">+ </span><span class="s1">after</span>
                    <span class="s2">if </span><span class="s4">&quot;$&quot; </span><span class="s2">in </span><span class="s1">after</span><span class="s3">:</span>
                        <span class="s1">notdone</span><span class="s3">[</span><span class="s1">name</span><span class="s3">] = </span><span class="s1">value</span>
                    <span class="s2">else</span><span class="s3">:</span>
                        <span class="s2">try</span><span class="s3">:</span>
                            <span class="s1">value </span><span class="s3">= </span><span class="s1">int</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
                        <span class="s2">except </span><span class="s1">ValueError</span><span class="s3">:</span>
                            <span class="s1">done</span><span class="s3">[</span><span class="s1">name</span><span class="s3">] = </span><span class="s1">value</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>
                        <span class="s2">else</span><span class="s3">:</span>
                            <span class="s1">done</span><span class="s3">[</span><span class="s1">name</span><span class="s3">] = </span><span class="s1">value</span>
                        <span class="s2">del </span><span class="s1">notdone</span><span class="s3">[</span><span class="s1">name</span><span class="s3">]</span>

                        <span class="s2">if </span><span class="s1">name</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">'PY_'</span><span class="s3">) </span><span class="s2">and </span><span class="s1">name</span><span class="s3">[</span><span class="s6">3</span><span class="s3">:] </span><span class="s2">in </span><span class="s1">renamed_variables</span><span class="s3">:</span>

                            <span class="s1">name </span><span class="s3">= </span><span class="s1">name</span><span class="s3">[</span><span class="s6">3</span><span class="s3">:]</span>
                            <span class="s2">if </span><span class="s1">name </span><span class="s2">not in </span><span class="s1">done</span><span class="s3">:</span>
                                <span class="s1">done</span><span class="s3">[</span><span class="s1">name</span><span class="s3">] = </span><span class="s1">value</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s5"># bogus variable reference; just drop it since we can't deal</span>
                <span class="s2">del </span><span class="s1">notdone</span><span class="s3">[</span><span class="s1">name</span><span class="s3">]</span>

    <span class="s1">fp</span><span class="s3">.</span><span class="s1">close</span><span class="s3">()</span>

    <span class="s5"># strip spurious spaces</span>
    <span class="s2">for </span><span class="s1">k</span><span class="s3">, </span><span class="s1">v </span><span class="s2">in </span><span class="s1">done</span><span class="s3">.</span><span class="s1">items</span><span class="s3">():</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">v</span><span class="s3">, </span><span class="s1">str</span><span class="s3">):</span>
            <span class="s1">done</span><span class="s3">[</span><span class="s1">k</span><span class="s3">] = </span><span class="s1">v</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>

    <span class="s5"># save the results in the global dictionary</span>
    <span class="s1">g</span><span class="s3">.</span><span class="s1">update</span><span class="s3">(</span><span class="s1">done</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">g</span>


<span class="s2">def </span><span class="s1">expand_makefile_vars</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">vars</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Expand Makefile-style variables -- &quot;${foo}&quot; or &quot;$(foo)&quot; -- in 
    'string' according to 'vars' (a dictionary mapping variable names to 
    values).  Variables not present in 'vars' are silently expanded to the 
    empty string.  The variable values in 'vars' should not contain further 
    variable expansions; if 'vars' is the output of 'parse_makefile()', 
    you're fine.  Returns a variable-expanded version of 's'. 
    &quot;&quot;&quot;</span>

    <span class="s5"># This algorithm does multiple expansion, so if vars['foo'] contains</span>
    <span class="s5"># &quot;${bar}&quot;, it will expand ${foo} to ${bar}, and then expand</span>
    <span class="s5"># ${bar}... and so forth.  This is fine as long as 'vars' comes from</span>
    <span class="s5"># 'parse_makefile()', which takes care of such expansions eagerly,</span>
    <span class="s5"># according to make's variable expansion semantics.</span>

    <span class="s2">while True</span><span class="s3">:</span>
        <span class="s1">m </span><span class="s3">= </span><span class="s1">_findvar1_rx</span><span class="s3">.</span><span class="s1">search</span><span class="s3">(</span><span class="s1">s</span><span class="s3">) </span><span class="s2">or </span><span class="s1">_findvar2_rx</span><span class="s3">.</span><span class="s1">search</span><span class="s3">(</span><span class="s1">s</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">m</span><span class="s3">:</span>
            <span class="s3">(</span><span class="s1">beg</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) = </span><span class="s1">m</span><span class="s3">.</span><span class="s1">span</span><span class="s3">()</span>
            <span class="s1">s </span><span class="s3">= </span><span class="s1">s</span><span class="s3">[</span><span class="s6">0</span><span class="s3">:</span><span class="s1">beg</span><span class="s3">] + </span><span class="s1">vars</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">m</span><span class="s3">.</span><span class="s1">group</span><span class="s3">(</span><span class="s6">1</span><span class="s3">)) + </span><span class="s1">s</span><span class="s3">[</span><span class="s1">end</span><span class="s3">:]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">break</span>
    <span class="s2">return </span><span class="s1">s</span>


<span class="s1">_config_vars </span><span class="s3">= </span><span class="s2">None</span>


<span class="s2">def </span><span class="s1">get_config_vars</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;With no arguments, return a dictionary of all configuration 
    variables relevant for the current platform.  Generally this includes 
    everything needed to build extensions and install both pure modules and 
    extensions.  On Unix, this means every variable defined in Python's 
    installed Makefile; on Windows it's a much smaller set. 
 
    With arguments, return a list of values that result from looking up 
    each argument in the configuration variable dictionary. 
    &quot;&quot;&quot;</span>
    <span class="s2">global </span><span class="s1">_config_vars</span>
    <span class="s2">if </span><span class="s1">_config_vars </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">_config_vars </span><span class="s3">= </span><span class="s1">sysconfig</span><span class="s3">.</span><span class="s1">get_config_vars</span><span class="s3">().</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">py39compat</span><span class="s3">.</span><span class="s1">add_ext_suffix</span><span class="s3">(</span><span class="s1">_config_vars</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">args</span><span class="s3">:</span>
        <span class="s1">vals </span><span class="s3">= []</span>
        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">args</span><span class="s3">:</span>
            <span class="s1">vals</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">_config_vars</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">name</span><span class="s3">))</span>
        <span class="s2">return </span><span class="s1">vals</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">_config_vars</span>


<span class="s2">def </span><span class="s1">get_config_var</span><span class="s3">(</span><span class="s1">name</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Return the value of a single variable using the dictionary 
    returned by 'get_config_vars()'.  Equivalent to 
    get_config_vars().get(name) 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">name </span><span class="s3">== </span><span class="s4">'SO'</span><span class="s3">:</span>
        <span class="s2">import </span><span class="s1">warnings</span>

        <span class="s1">warnings</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s4">'SO is deprecated, use EXT_SUFFIX'</span><span class="s3">, </span><span class="s1">DeprecationWarning</span><span class="s3">, </span><span class="s6">2</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">get_config_vars</span><span class="s3">().</span><span class="s1">get</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)</span>
</pre>
</body>
</html>