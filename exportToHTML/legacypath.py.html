<html>
<head>
<title>legacypath.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
legacypath.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Add backward compatibility support for the legacy py path type.&quot;&quot;&quot;</span>
<span class="s2">import </span><span class="s1">dataclasses</span>
<span class="s2">import </span><span class="s1">shlex</span>
<span class="s2">import </span><span class="s1">subprocess</span>
<span class="s2">from </span><span class="s1">pathlib </span><span class="s2">import </span><span class="s1">Path</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">List</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Optional</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">TYPE_CHECKING</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Union</span>

<span class="s2">from </span><span class="s1">iniconfig </span><span class="s2">import </span><span class="s1">SectionWrapper</span>

<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">cacheprovider </span><span class="s2">import </span><span class="s1">Cache</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">compat </span><span class="s2">import </span><span class="s1">final</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">compat </span><span class="s2">import </span><span class="s1">LEGACY_PATH</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">compat </span><span class="s2">import </span><span class="s1">legacy_path</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">config </span><span class="s2">import </span><span class="s1">Config</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">config </span><span class="s2">import </span><span class="s1">hookimpl</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">config </span><span class="s2">import </span><span class="s1">PytestPluginManager</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">deprecated </span><span class="s2">import </span><span class="s1">check_ispytest</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">fixtures </span><span class="s2">import </span><span class="s1">fixture</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">fixtures </span><span class="s2">import </span><span class="s1">FixtureRequest</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">main </span><span class="s2">import </span><span class="s1">Session</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">monkeypatch </span><span class="s2">import </span><span class="s1">MonkeyPatch</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">nodes </span><span class="s2">import </span><span class="s1">Collector</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">nodes </span><span class="s2">import </span><span class="s1">Item</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">nodes </span><span class="s2">import </span><span class="s1">Node</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">pytester </span><span class="s2">import </span><span class="s1">HookRecorder</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">pytester </span><span class="s2">import </span><span class="s1">Pytester</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">pytester </span><span class="s2">import </span><span class="s1">RunResult</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">terminal </span><span class="s2">import </span><span class="s1">TerminalReporter</span>
<span class="s2">from </span><span class="s1">_pytest</span><span class="s3">.</span><span class="s1">tmpdir </span><span class="s2">import </span><span class="s1">TempPathFactory</span>

<span class="s2">if </span><span class="s1">TYPE_CHECKING</span><span class="s3">:</span>
    <span class="s2">from </span><span class="s1">typing_extensions </span><span class="s2">import </span><span class="s1">Final</span>

    <span class="s2">import </span><span class="s1">pexpect</span>


<span class="s3">@</span><span class="s1">final</span>
<span class="s2">class </span><span class="s1">Testdir</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Similar to :class:`Pytester`, but this class works with legacy legacy_path objects instead. 
 
    All methods just forward to an internal :class:`Pytester` instance, converting results 
    to `legacy_path` objects as necessary. 
    &quot;&quot;&quot;</span>

    <span class="s1">__test__ </span><span class="s3">= </span><span class="s2">False</span>

    <span class="s1">CLOSE_STDIN</span><span class="s3">: </span><span class="s4">&quot;Final&quot; </span><span class="s3">= </span><span class="s1">Pytester</span><span class="s3">.</span><span class="s1">CLOSE_STDIN</span>
    <span class="s1">TimeoutExpired</span><span class="s3">: </span><span class="s4">&quot;Final&quot; </span><span class="s3">= </span><span class="s1">Pytester</span><span class="s3">.</span><span class="s1">TimeoutExpired</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">pytester</span><span class="s3">: </span><span class="s1">Pytester</span><span class="s3">, *, </span><span class="s1">_ispytest</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">check_ispytest</span><span class="s3">(</span><span class="s1">_ispytest</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester </span><span class="s3">= </span><span class="s1">pytester</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">tmpdir</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Temporary directory where tests are executed.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">path</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">test_tmproot</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">_test_tmproot</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">request</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">_request</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">plugins</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">plugins</span>

    <span class="s3">@</span><span class="s1">plugins</span><span class="s3">.</span><span class="s1">setter</span>
    <span class="s2">def </span><span class="s1">plugins</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">plugins</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">plugins </span><span class="s3">= </span><span class="s1">plugins</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">monkeypatch</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; MonkeyPatch</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">_monkeypatch</span>

    <span class="s2">def </span><span class="s1">make_hook_recorder</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">pluginmanager</span><span class="s3">) </span><span class="s1">-&gt; HookRecorder</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.make_hook_recorder`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">make_hook_recorder</span><span class="s3">(</span><span class="s1">pluginmanager</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">chdir</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.chdir`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">chdir</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">finalize</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester._finalize`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">_finalize</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">makefile</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.makefile`.&quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">ext </span><span class="s2">and not </span><span class="s1">ext</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;.&quot;</span><span class="s3">):</span>
            <span class="s5"># pytester.makefile is going to throw a ValueError in a way that</span>
            <span class="s5"># testdir.makefile did not, because</span>
            <span class="s5"># pathlib.Path is stricter suffixes than py.path</span>
            <span class="s5"># This ext arguments is likely user error, but since testdir has</span>
            <span class="s5"># allowed this, we will prepend &quot;.&quot; as a workaround to avoid breaking</span>
            <span class="s5"># testdir usage that worked before</span>
            <span class="s1">ext </span><span class="s3">= </span><span class="s4">&quot;.&quot; </span><span class="s3">+ </span><span class="s1">ext</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">makefile</span><span class="s3">(</span><span class="s1">ext</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">makeconftest</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">source</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.makeconftest`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">makeconftest</span><span class="s3">(</span><span class="s1">source</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">makeini</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">source</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.makeini`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">makeini</span><span class="s3">(</span><span class="s1">source</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">getinicfg</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">source</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; SectionWrapper</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.getinicfg`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">getinicfg</span><span class="s3">(</span><span class="s1">source</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">makepyprojecttoml</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">source</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.makepyprojecttoml`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">makepyprojecttoml</span><span class="s3">(</span><span class="s1">source</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">makepyfile</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.makepyfile`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">makepyfile</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">maketxtfile</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.maketxtfile`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">maketxtfile</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">syspathinsert</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">path</span><span class="s3">=</span><span class="s2">None</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.syspathinsert`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">syspathinsert</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">mkdir</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">name</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.mkdir`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">mkdir</span><span class="s3">(</span><span class="s1">name</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">mkpydir</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">name</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.mkpydir`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">mkpydir</span><span class="s3">(</span><span class="s1">name</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">copy_example</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s2">None</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.copy_example`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">copy_example</span><span class="s3">(</span><span class="s1">name</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">getnode</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">config</span><span class="s3">: </span><span class="s1">Config</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">) </span><span class="s1">-&gt; Optional</span><span class="s3">[</span><span class="s1">Union</span><span class="s3">[</span><span class="s1">Item</span><span class="s3">, </span><span class="s1">Collector</span><span class="s3">]]:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.getnode`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">getnode</span><span class="s3">(</span><span class="s1">config</span><span class="s3">, </span><span class="s1">arg</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">getpathnode</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">path</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.getpathnode`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">getpathnode</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">genitems</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">colitems</span><span class="s3">: </span><span class="s1">List</span><span class="s3">[</span><span class="s1">Union</span><span class="s3">[</span><span class="s1">Item</span><span class="s3">, </span><span class="s1">Collector</span><span class="s3">]]) </span><span class="s1">-&gt; List</span><span class="s3">[</span><span class="s1">Item</span><span class="s3">]:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.genitems`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">genitems</span><span class="s3">(</span><span class="s1">colitems</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">runitem</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">source</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.runitem`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">runitem</span><span class="s3">(</span><span class="s1">source</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">inline_runsource</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">source</span><span class="s3">, *</span><span class="s1">cmdlineargs</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.inline_runsource`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">inline_runsource</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, *</span><span class="s1">cmdlineargs</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">inline_genitems</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.inline_genitems`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">inline_genitems</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">inline_run</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, </span><span class="s1">plugins</span><span class="s3">=(), </span><span class="s1">no_reraise_ctrlc</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.inline_run`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">inline_run</span><span class="s3">(</span>
            <span class="s3">*</span><span class="s1">args</span><span class="s3">, </span><span class="s1">plugins</span><span class="s3">=</span><span class="s1">plugins</span><span class="s3">, </span><span class="s1">no_reraise_ctrlc</span><span class="s3">=</span><span class="s1">no_reraise_ctrlc</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">runpytest_inprocess</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; RunResult</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.runpytest_inprocess`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">runpytest_inprocess</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">runpytest</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; RunResult</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.runpytest`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">runpytest</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">parseconfig</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">) </span><span class="s1">-&gt; Config</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.parseconfig`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">parseconfig</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">parseconfigure</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">) </span><span class="s1">-&gt; Config</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.parseconfigure`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">parseconfigure</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">getitem</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">source</span><span class="s3">, </span><span class="s1">funcname</span><span class="s3">=</span><span class="s4">&quot;test_func&quot;</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.getitem`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">getitem</span><span class="s3">(</span><span class="s1">source</span><span class="s3">, </span><span class="s1">funcname</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">getitems</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">source</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.getitems`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">getitems</span><span class="s3">(</span><span class="s1">source</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">getmodulecol</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">source</span><span class="s3">, </span><span class="s1">configargs</span><span class="s3">=(), </span><span class="s1">withinit</span><span class="s3">=</span><span class="s2">False</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.getmodulecol`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">getmodulecol</span><span class="s3">(</span>
            <span class="s1">source</span><span class="s3">, </span><span class="s1">configargs</span><span class="s3">=</span><span class="s1">configargs</span><span class="s3">, </span><span class="s1">withinit</span><span class="s3">=</span><span class="s1">withinit</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">collect_by_name</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">modcol</span><span class="s3">: </span><span class="s1">Collector</span><span class="s3">, </span><span class="s1">name</span><span class="s3">: </span><span class="s1">str</span>
    <span class="s3">) </span><span class="s1">-&gt; Optional</span><span class="s3">[</span><span class="s1">Union</span><span class="s3">[</span><span class="s1">Item</span><span class="s3">, </span><span class="s1">Collector</span><span class="s3">]]:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.collect_by_name`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">collect_by_name</span><span class="s3">(</span><span class="s1">modcol</span><span class="s3">, </span><span class="s1">name</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">popen</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">cmdargs</span><span class="s3">,</span>
        <span class="s1">stdout</span><span class="s3">=</span><span class="s1">subprocess</span><span class="s3">.</span><span class="s1">PIPE</span><span class="s3">,</span>
        <span class="s1">stderr</span><span class="s3">=</span><span class="s1">subprocess</span><span class="s3">.</span><span class="s1">PIPE</span><span class="s3">,</span>
        <span class="s1">stdin</span><span class="s3">=</span><span class="s1">CLOSE_STDIN</span><span class="s3">,</span>
        <span class="s3">**</span><span class="s1">kw</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.popen`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">popen</span><span class="s3">(</span><span class="s1">cmdargs</span><span class="s3">, </span><span class="s1">stdout</span><span class="s3">, </span><span class="s1">stderr</span><span class="s3">, </span><span class="s1">stdin</span><span class="s3">, **</span><span class="s1">kw</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">run</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">cmdargs</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">stdin</span><span class="s3">=</span><span class="s1">CLOSE_STDIN</span><span class="s3">) </span><span class="s1">-&gt; RunResult</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.run`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">run</span><span class="s3">(*</span><span class="s1">cmdargs</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">=</span><span class="s1">timeout</span><span class="s3">, </span><span class="s1">stdin</span><span class="s3">=</span><span class="s1">stdin</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">runpython</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">script</span><span class="s3">) </span><span class="s1">-&gt; RunResult</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.runpython`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">runpython</span><span class="s3">(</span><span class="s1">script</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">runpython_c</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">command</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.runpython_c`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">runpython_c</span><span class="s3">(</span><span class="s1">command</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">runpytest_subprocess</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">=</span><span class="s2">None</span><span class="s3">) </span><span class="s1">-&gt; RunResult</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.runpytest_subprocess`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">runpytest_subprocess</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, </span><span class="s1">timeout</span><span class="s3">=</span><span class="s1">timeout</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">spawn_pytest</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">string</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">expect_timeout</span><span class="s3">: </span><span class="s1">float </span><span class="s3">= </span><span class="s6">10.0</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;pexpect.spawn&quot;</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.spawn_pytest`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">spawn_pytest</span><span class="s3">(</span><span class="s1">string</span><span class="s3">, </span><span class="s1">expect_timeout</span><span class="s3">=</span><span class="s1">expect_timeout</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">spawn</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cmd</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">expect_timeout</span><span class="s3">: </span><span class="s1">float </span><span class="s3">= </span><span class="s6">10.0</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s4">&quot;pexpect.spawn&quot;</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;See :meth:`Pytester.spawn`.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pytester</span><span class="s3">.</span><span class="s1">spawn</span><span class="s3">(</span><span class="s1">cmd</span><span class="s3">, </span><span class="s1">expect_timeout</span><span class="s3">=</span><span class="s1">expect_timeout</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__repr__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s4">f&quot;&lt;Testdir </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tmpdir</span><span class="s2">!r}</span><span class="s4">&gt;&quot;</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tmpdir</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">LegacyTestdirPlugin</span><span class="s3">:</span>
    <span class="s3">@</span><span class="s1">staticmethod</span>
    <span class="s3">@</span><span class="s1">fixture</span>
    <span class="s2">def </span><span class="s1">testdir</span><span class="s3">(</span><span class="s1">pytester</span><span class="s3">: </span><span class="s1">Pytester</span><span class="s3">) </span><span class="s1">-&gt; Testdir</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Identical to :fixture:`pytester`, and provides an instance whose methods return 
        legacy ``LEGACY_PATH`` objects instead when applicable. 
 
        New code should avoid using :fixture:`testdir` in favor of :fixture:`pytester`. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">Testdir</span><span class="s3">(</span><span class="s1">pytester</span><span class="s3">, </span><span class="s1">_ispytest</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">final</span>
<span class="s3">@</span><span class="s1">dataclasses</span><span class="s3">.</span><span class="s1">dataclass</span>
<span class="s2">class </span><span class="s1">TempdirFactory</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Backward compatibility wrapper that implements :class:`py.path.local` 
    for :class:`TempPathFactory`. 
 
    .. note:: 
        These days, it is preferred to use ``tmp_path_factory``. 
 
        :ref:`About the tmpdir and tmpdir_factory fixtures&lt;tmpdir and tmpdir_factory&gt;`. 
 
    &quot;&quot;&quot;</span>

    <span class="s1">_tmppath_factory</span><span class="s3">: </span><span class="s1">TempPathFactory</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">tmppath_factory</span><span class="s3">: </span><span class="s1">TempPathFactory</span><span class="s3">, *, </span><span class="s1">_ispytest</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">check_ispytest</span><span class="s3">(</span><span class="s1">_ispytest</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_tmppath_factory </span><span class="s3">= </span><span class="s1">tmppath_factory</span>

    <span class="s2">def </span><span class="s1">mktemp</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">basename</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">numbered</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Same as :meth:`TempPathFactory.mktemp`, but returns a :class:`py.path.local` object.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_tmppath_factory</span><span class="s3">.</span><span class="s1">mktemp</span><span class="s3">(</span><span class="s1">basename</span><span class="s3">, </span><span class="s1">numbered</span><span class="s3">).</span><span class="s1">resolve</span><span class="s3">())</span>

    <span class="s2">def </span><span class="s1">getbasetemp</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Same as :meth:`TempPathFactory.getbasetemp`, but returns a :class:`py.path.local` object.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_tmppath_factory</span><span class="s3">.</span><span class="s1">getbasetemp</span><span class="s3">().</span><span class="s1">resolve</span><span class="s3">())</span>


<span class="s2">class </span><span class="s1">LegacyTmpdirPlugin</span><span class="s3">:</span>
    <span class="s3">@</span><span class="s1">staticmethod</span>
    <span class="s3">@</span><span class="s1">fixture</span><span class="s3">(</span><span class="s1">scope</span><span class="s3">=</span><span class="s4">&quot;session&quot;</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">tmpdir_factory</span><span class="s3">(</span><span class="s1">request</span><span class="s3">: </span><span class="s1">FixtureRequest</span><span class="s3">) </span><span class="s1">-&gt; TempdirFactory</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Return a :class:`pytest.TempdirFactory` instance for the test session.&quot;&quot;&quot;</span>
        <span class="s5"># Set dynamically by pytest_configure().</span>
        <span class="s2">return </span><span class="s1">request</span><span class="s3">.</span><span class="s1">config</span><span class="s3">.</span><span class="s1">_tmpdirhandler  </span><span class="s5"># type: ignore</span>

    <span class="s3">@</span><span class="s1">staticmethod</span>
    <span class="s3">@</span><span class="s1">fixture</span>
    <span class="s2">def </span><span class="s1">tmpdir</span><span class="s3">(</span><span class="s1">tmp_path</span><span class="s3">: </span><span class="s1">Path</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Return a temporary directory path object which is unique to each test 
        function invocation, created as a sub directory of the base temporary 
        directory. 
 
        By default, a new base temporary directory is created each test session, 
        and old bases are removed after 3 sessions, to aid in debugging. If 
        ``--basetemp`` is used then it is cleared each session. See :ref:`base 
        temporary directory`. 
 
        The returned object is a `legacy_path`_ object. 
 
        .. note:: 
            These days, it is preferred to use ``tmp_path``. 
 
            :ref:`About the tmpdir and tmpdir_factory fixtures&lt;tmpdir and tmpdir_factory&gt;`. 
 
        .. _legacy_path: https://py.readthedocs.io/en/latest/path.html 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">tmp_path</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">Cache_makedir</span><span class="s3">(</span><span class="s1">self</span><span class="s3">: </span><span class="s1">Cache</span><span class="s3">, </span><span class="s1">name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Return a directory path object with the given name. 
 
    Same as :func:`mkdir`, but returns a legacy py path instance. 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">mkdir</span><span class="s3">(</span><span class="s1">name</span><span class="s3">))</span>


<span class="s2">def </span><span class="s1">FixtureRequest_fspath</span><span class="s3">(</span><span class="s1">self</span><span class="s3">: </span><span class="s1">FixtureRequest</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;(deprecated) The file system path of the test module which collected this test.&quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">path</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">TerminalReporter_startdir</span><span class="s3">(</span><span class="s1">self</span><span class="s3">: </span><span class="s1">TerminalReporter</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;The directory from which pytest was invoked. 
 
    Prefer to use ``startpath`` which is a :class:`pathlib.Path`. 
 
    :type: LEGACY_PATH 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">startpath</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">Config_invocation_dir</span><span class="s3">(</span><span class="s1">self</span><span class="s3">: </span><span class="s1">Config</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;The directory from which pytest was invoked. 
 
    Prefer to use :attr:`invocation_params.dir &lt;InvocationParams.dir&gt;`, 
    which is a :class:`pathlib.Path`. 
 
    :type: LEGACY_PATH 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">str</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">invocation_params</span><span class="s3">.</span><span class="s1">dir</span><span class="s3">))</span>


<span class="s2">def </span><span class="s1">Config_rootdir</span><span class="s3">(</span><span class="s1">self</span><span class="s3">: </span><span class="s1">Config</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;The path to the :ref:`rootdir &lt;rootdir&gt;`. 
 
    Prefer to use :attr:`rootpath`, which is a :class:`pathlib.Path`. 
 
    :type: LEGACY_PATH 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">str</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">rootpath</span><span class="s3">))</span>


<span class="s2">def </span><span class="s1">Config_inifile</span><span class="s3">(</span><span class="s1">self</span><span class="s3">: </span><span class="s1">Config</span><span class="s3">) </span><span class="s1">-&gt; Optional</span><span class="s3">[</span><span class="s1">LEGACY_PATH</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot;The path to the :ref:`configfile &lt;configfiles&gt;`. 
 
    Prefer to use :attr:`inipath`, which is a :class:`pathlib.Path`. 
 
    :type: Optional[LEGACY_PATH] 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">str</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">inipath</span><span class="s3">)) </span><span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">inipath </span><span class="s2">else None</span>


<span class="s2">def </span><span class="s1">Session_stardir</span><span class="s3">(</span><span class="s1">self</span><span class="s3">: </span><span class="s1">Session</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;The path from which pytest was invoked. 
 
    Prefer to use ``startpath`` which is a :class:`pathlib.Path`. 
 
    :type: LEGACY_PATH 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">startpath</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">Config__getini_unknown_type</span><span class="s3">(</span>
    <span class="s1">self</span><span class="s3">, </span><span class="s1">name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">type</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">value</span><span class="s3">: </span><span class="s1">Union</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">List</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]]</span>
<span class="s3">):</span>
    <span class="s2">if </span><span class="s1">type </span><span class="s3">== </span><span class="s4">&quot;pathlist&quot;</span><span class="s3">:</span>
        <span class="s5"># TODO: This assert is probably not valid in all cases.</span>
        <span class="s2">assert </span><span class="s1">self</span><span class="s3">.</span><span class="s1">inipath </span><span class="s2">is not None</span>
        <span class="s1">dp </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">inipath</span><span class="s3">.</span><span class="s1">parent</span>
        <span class="s1">input_values </span><span class="s3">= </span><span class="s1">shlex</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) </span><span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">str</span><span class="s3">) </span><span class="s2">else </span><span class="s1">value</span>
        <span class="s2">return </span><span class="s3">[</span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">str</span><span class="s3">(</span><span class="s1">dp </span><span class="s3">/ </span><span class="s1">x</span><span class="s3">)) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">input_values</span><span class="s3">]</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">f&quot;unknown configuration type: </span><span class="s2">{</span><span class="s1">type</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">, </span><span class="s1">value</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">Node_fspath</span><span class="s3">(</span><span class="s1">self</span><span class="s3">: </span><span class="s1">Node</span><span class="s3">) </span><span class="s1">-&gt; LEGACY_PATH</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;(deprecated) returns a legacy_path copy of self.path&quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">legacy_path</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">path</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">Node_fspath_set</span><span class="s3">(</span><span class="s1">self</span><span class="s3">: </span><span class="s1">Node</span><span class="s3">, </span><span class="s1">value</span><span class="s3">: </span><span class="s1">LEGACY_PATH</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s1">self</span><span class="s3">.</span><span class="s1">path </span><span class="s3">= </span><span class="s1">Path</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">hookimpl</span><span class="s3">(</span><span class="s1">tryfirst</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">pytest_load_initial_conftests</span><span class="s3">(</span><span class="s1">early_config</span><span class="s3">: </span><span class="s1">Config</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Monkeypatch legacy path attributes in several classes, as early as possible.&quot;&quot;&quot;</span>
    <span class="s1">mp </span><span class="s3">= </span><span class="s1">MonkeyPatch</span><span class="s3">()</span>
    <span class="s1">early_config</span><span class="s3">.</span><span class="s1">add_cleanup</span><span class="s3">(</span><span class="s1">mp</span><span class="s3">.</span><span class="s1">undo</span><span class="s3">)</span>

    <span class="s5"># Add Cache.makedir().</span>
    <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span><span class="s1">Cache</span><span class="s3">, </span><span class="s4">&quot;makedir&quot;</span><span class="s3">, </span><span class="s1">Cache_makedir</span><span class="s3">, </span><span class="s1">raising</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>

    <span class="s5"># Add FixtureRequest.fspath property.</span>
    <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span><span class="s1">FixtureRequest</span><span class="s3">, </span><span class="s4">&quot;fspath&quot;</span><span class="s3">, </span><span class="s1">property</span><span class="s3">(</span><span class="s1">FixtureRequest_fspath</span><span class="s3">), </span><span class="s1">raising</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>

    <span class="s5"># Add TerminalReporter.startdir property.</span>
    <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span>
        <span class="s1">TerminalReporter</span><span class="s3">, </span><span class="s4">&quot;startdir&quot;</span><span class="s3">, </span><span class="s1">property</span><span class="s3">(</span><span class="s1">TerminalReporter_startdir</span><span class="s3">), </span><span class="s1">raising</span><span class="s3">=</span><span class="s2">False</span>
    <span class="s3">)</span>

    <span class="s5"># Add Config.{invocation_dir,rootdir,inifile} properties.</span>
    <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span><span class="s1">Config</span><span class="s3">, </span><span class="s4">&quot;invocation_dir&quot;</span><span class="s3">, </span><span class="s1">property</span><span class="s3">(</span><span class="s1">Config_invocation_dir</span><span class="s3">), </span><span class="s1">raising</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
    <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span><span class="s1">Config</span><span class="s3">, </span><span class="s4">&quot;rootdir&quot;</span><span class="s3">, </span><span class="s1">property</span><span class="s3">(</span><span class="s1">Config_rootdir</span><span class="s3">), </span><span class="s1">raising</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
    <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span><span class="s1">Config</span><span class="s3">, </span><span class="s4">&quot;inifile&quot;</span><span class="s3">, </span><span class="s1">property</span><span class="s3">(</span><span class="s1">Config_inifile</span><span class="s3">), </span><span class="s1">raising</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>

    <span class="s5"># Add Session.startdir property.</span>
    <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span><span class="s1">Session</span><span class="s3">, </span><span class="s4">&quot;startdir&quot;</span><span class="s3">, </span><span class="s1">property</span><span class="s3">(</span><span class="s1">Session_stardir</span><span class="s3">), </span><span class="s1">raising</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>

    <span class="s5"># Add pathlist configuration type.</span>
    <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span><span class="s1">Config</span><span class="s3">, </span><span class="s4">&quot;_getini_unknown_type&quot;</span><span class="s3">, </span><span class="s1">Config__getini_unknown_type</span><span class="s3">)</span>

    <span class="s5"># Add Node.fspath property.</span>
    <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span><span class="s1">Node</span><span class="s3">, </span><span class="s4">&quot;fspath&quot;</span><span class="s3">, </span><span class="s1">property</span><span class="s3">(</span><span class="s1">Node_fspath</span><span class="s3">, </span><span class="s1">Node_fspath_set</span><span class="s3">), </span><span class="s1">raising</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">hookimpl</span>
<span class="s2">def </span><span class="s1">pytest_configure</span><span class="s3">(</span><span class="s1">config</span><span class="s3">: </span><span class="s1">Config</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Installs the LegacyTmpdirPlugin if the ``tmpdir`` plugin is also installed.&quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">config</span><span class="s3">.</span><span class="s1">pluginmanager</span><span class="s3">.</span><span class="s1">has_plugin</span><span class="s3">(</span><span class="s4">&quot;tmpdir&quot;</span><span class="s3">):</span>
        <span class="s1">mp </span><span class="s3">= </span><span class="s1">MonkeyPatch</span><span class="s3">()</span>
        <span class="s1">config</span><span class="s3">.</span><span class="s1">add_cleanup</span><span class="s3">(</span><span class="s1">mp</span><span class="s3">.</span><span class="s1">undo</span><span class="s3">)</span>
        <span class="s5"># Create TmpdirFactory and attach it to the config object.</span>
        <span class="s5">#</span>
        <span class="s5"># This is to comply with existing plugins which expect the handler to be</span>
        <span class="s5"># available at pytest_configure time, but ideally should be moved entirely</span>
        <span class="s5"># to the tmpdir_factory session fixture.</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">tmp_path_factory </span><span class="s3">= </span><span class="s1">config</span><span class="s3">.</span><span class="s1">_tmp_path_factory  </span><span class="s5"># type: ignore[attr-defined]</span>
        <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
            <span class="s5"># tmpdir plugin is blocked.</span>
            <span class="s2">pass</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">_tmpdirhandler </span><span class="s3">= </span><span class="s1">TempdirFactory</span><span class="s3">(</span><span class="s1">tmp_path_factory</span><span class="s3">, </span><span class="s1">_ispytest</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
            <span class="s1">mp</span><span class="s3">.</span><span class="s1">setattr</span><span class="s3">(</span><span class="s1">config</span><span class="s3">, </span><span class="s4">&quot;_tmpdirhandler&quot;</span><span class="s3">, </span><span class="s1">_tmpdirhandler</span><span class="s3">, </span><span class="s1">raising</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>

        <span class="s1">config</span><span class="s3">.</span><span class="s1">pluginmanager</span><span class="s3">.</span><span class="s1">register</span><span class="s3">(</span><span class="s1">LegacyTmpdirPlugin</span><span class="s3">, </span><span class="s4">&quot;legacypath-tmpdir&quot;</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">hookimpl</span>
<span class="s2">def </span><span class="s1">pytest_plugin_registered</span><span class="s3">(</span><span class="s1">plugin</span><span class="s3">: </span><span class="s1">object</span><span class="s3">, </span><span class="s1">manager</span><span class="s3">: </span><span class="s1">PytestPluginManager</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s5"># pytester is not loaded by default and is commonly loaded from a conftest,</span>
    <span class="s5"># so checking for it in `pytest_configure` is not enough.</span>
    <span class="s1">is_pytester </span><span class="s3">= </span><span class="s1">plugin </span><span class="s2">is </span><span class="s1">manager</span><span class="s3">.</span><span class="s1">get_plugin</span><span class="s3">(</span><span class="s4">&quot;pytester&quot;</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">is_pytester </span><span class="s2">and not </span><span class="s1">manager</span><span class="s3">.</span><span class="s1">is_registered</span><span class="s3">(</span><span class="s1">LegacyTestdirPlugin</span><span class="s3">):</span>
        <span class="s1">manager</span><span class="s3">.</span><span class="s1">register</span><span class="s3">(</span><span class="s1">LegacyTestdirPlugin</span><span class="s3">, </span><span class="s4">&quot;legacypath-pytester&quot;</span><span class="s3">)</span>
</pre>
</body>
</html>