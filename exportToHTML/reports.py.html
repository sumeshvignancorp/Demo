<html>
<head>
<title>reports.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
reports.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">dataclasses</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">from </span><span class="s1">io </span><span class="s0">import </span><span class="s1">StringIO</span>
<span class="s0">from </span><span class="s1">pprint </span><span class="s0">import </span><span class="s1">pprint</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Any</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">cast</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Dict</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Iterable</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Iterator</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">List</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Mapping</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">NoReturn</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Optional</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Tuple</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Type</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">TYPE_CHECKING</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">TypeVar</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">Union</span>

<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ExceptionChainRepr</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ExceptionInfo</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ExceptionRepr</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ReprEntry</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ReprEntryNative</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ReprExceptionInfo</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ReprFileLocation</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ReprFuncArgs</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ReprLocals</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">ReprTraceback</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_code</span><span class="s2">.</span><span class="s1">code </span><span class="s0">import </span><span class="s1">TerminalRepr</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">_io </span><span class="s0">import </span><span class="s1">TerminalWriter</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">compat </span><span class="s0">import </span><span class="s1">final</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">config </span><span class="s0">import </span><span class="s1">Config</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">nodes </span><span class="s0">import </span><span class="s1">Collector</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">nodes </span><span class="s0">import </span><span class="s1">Item</span>
<span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">outcomes </span><span class="s0">import </span><span class="s1">skip</span>

<span class="s0">if </span><span class="s1">TYPE_CHECKING</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">typing_extensions </span><span class="s0">import </span><span class="s1">Literal</span>

    <span class="s0">from </span><span class="s1">_pytest</span><span class="s2">.</span><span class="s1">runner </span><span class="s0">import </span><span class="s1">CallInfo</span>


<span class="s0">def </span><span class="s1">getworkerinfoline</span><span class="s2">(</span><span class="s1">node</span><span class="s2">):</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">node</span><span class="s2">.</span><span class="s1">_workerinfocache</span>
    <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
        <span class="s1">d </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">workerinfo</span>
        <span class="s1">ver </span><span class="s2">= </span><span class="s3">&quot;%s.%s.%s&quot; </span><span class="s2">% </span><span class="s1">d</span><span class="s2">[</span><span class="s3">&quot;version_info&quot;</span><span class="s2">][:</span><span class="s4">3</span><span class="s2">]</span>
        <span class="s1">node</span><span class="s2">.</span><span class="s1">_workerinfocache </span><span class="s2">= </span><span class="s1">s </span><span class="s2">= </span><span class="s3">&quot;[{}] {} -- Python {} {}&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
            <span class="s1">d</span><span class="s2">[</span><span class="s3">&quot;id&quot;</span><span class="s2">], </span><span class="s1">d</span><span class="s2">[</span><span class="s3">&quot;sysplatform&quot;</span><span class="s2">], </span><span class="s1">ver</span><span class="s2">, </span><span class="s1">d</span><span class="s2">[</span><span class="s3">&quot;executable&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s0">return </span><span class="s1">s</span>


<span class="s1">_R </span><span class="s2">= </span><span class="s1">TypeVar</span><span class="s2">(</span><span class="s3">&quot;_R&quot;</span><span class="s2">, </span><span class="s1">bound</span><span class="s2">=</span><span class="s3">&quot;BaseReport&quot;</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">BaseReport</span><span class="s2">:</span>
    <span class="s1">when</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">]</span>
    <span class="s1">location</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">int</span><span class="s2">], </span><span class="s1">str</span><span class="s2">]]</span>
    <span class="s1">longrepr</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span>
        <span class="s0">None</span><span class="s2">, </span><span class="s1">ExceptionInfo</span><span class="s2">[</span><span class="s1">BaseException</span><span class="s2">], </span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">int</span><span class="s2">, </span><span class="s1">str</span><span class="s2">], </span><span class="s1">str</span><span class="s2">, </span><span class="s1">TerminalRepr</span>
    <span class="s2">]</span>
    <span class="s1">sections</span><span class="s2">: </span><span class="s1">List</span><span class="s2">[</span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">str</span><span class="s2">]]</span>
    <span class="s1">nodeid</span><span class="s2">: </span><span class="s1">str</span>
    <span class="s1">outcome</span><span class="s2">: </span><span class="s3">&quot;Literal['passed', 'failed', 'skipped']&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">: </span><span class="s1">Any</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">kw</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">TYPE_CHECKING</span><span class="s2">:</span>
        <span class="s5"># Can have arbitrary fields given to __init__().</span>
        <span class="s0">def </span><span class="s1">__getattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; Any</span><span class="s2">:</span>
            <span class="s2">...</span>

    <span class="s0">def </span><span class="s1">toterminal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">out</span><span class="s2">: </span><span class="s1">TerminalWriter</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s3">&quot;node&quot;</span><span class="s2">):</span>
            <span class="s1">worker_info </span><span class="s2">= </span><span class="s1">getworkerinfoline</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">node</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">worker_info</span><span class="s2">:</span>
                <span class="s1">out</span><span class="s2">.</span><span class="s1">line</span><span class="s2">(</span><span class="s1">worker_info</span><span class="s2">)</span>

        <span class="s1">longrepr </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">longrepr</span>
        <span class="s0">if </span><span class="s1">longrepr </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s0">return</span>

        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">longrepr</span><span class="s2">, </span><span class="s3">&quot;toterminal&quot;</span><span class="s2">):</span>
            <span class="s1">longrepr_terminal </span><span class="s2">= </span><span class="s1">cast</span><span class="s2">(</span><span class="s1">TerminalRepr</span><span class="s2">, </span><span class="s1">longrepr</span><span class="s2">)</span>
            <span class="s1">longrepr_terminal</span><span class="s2">.</span><span class="s1">toterminal</span><span class="s2">(</span><span class="s1">out</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">s </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">longrepr</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">UnicodeEncodeError</span><span class="s2">:</span>
                <span class="s1">s </span><span class="s2">= </span><span class="s3">&quot;&lt;unprintable longrepr&gt;&quot;</span>
            <span class="s1">out</span><span class="s2">.</span><span class="s1">line</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_sections</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">prefix</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; Iterator</span><span class="s2">[</span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">str</span><span class="s2">]]:</span>
        <span class="s0">for </span><span class="s1">name</span><span class="s2">, </span><span class="s1">content </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">sections</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">name</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">):</span>
                <span class="s0">yield </span><span class="s1">prefix</span><span class="s2">, </span><span class="s1">content</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">longreprtext</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;Read-only property that returns the full string representation of 
        ``longrepr``. 
 
        .. versionadded:: 3.0 
        &quot;&quot;&quot;</span>
        <span class="s1">file </span><span class="s2">= </span><span class="s1">StringIO</span><span class="s2">()</span>
        <span class="s1">tw </span><span class="s2">= </span><span class="s1">TerminalWriter</span><span class="s2">(</span><span class="s1">file</span><span class="s2">)</span>
        <span class="s1">tw</span><span class="s2">.</span><span class="s1">hasmarkup </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">toterminal</span><span class="s2">(</span><span class="s1">tw</span><span class="s2">)</span>
        <span class="s1">exc </span><span class="s2">= </span><span class="s1">file</span><span class="s2">.</span><span class="s1">getvalue</span><span class="s2">()</span>
        <span class="s0">return </span><span class="s1">exc</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">caplog</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;Return captured log lines, if log capturing is enabled. 
 
        .. versionadded:: 3.5 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
            <span class="s1">content </span><span class="s0">for </span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">, </span><span class="s1">content</span><span class="s2">) </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_sections</span><span class="s2">(</span><span class="s3">&quot;Captured log&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">capstdout</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;Return captured text from stdout, if capturing is enabled. 
 
        .. versionadded:: 3.0 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s3">&quot;&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
            <span class="s1">content </span><span class="s0">for </span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">, </span><span class="s1">content</span><span class="s2">) </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_sections</span><span class="s2">(</span><span class="s3">&quot;Captured stdout&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">capstderr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;Return captured text from stderr, if capturing is enabled. 
 
        .. versionadded:: 3.0 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s3">&quot;&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
            <span class="s1">content </span><span class="s0">for </span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">, </span><span class="s1">content</span><span class="s2">) </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">get_sections</span><span class="s2">(</span><span class="s3">&quot;Captured stderr&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">passed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;Whether the outcome is passed.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">outcome </span><span class="s2">== </span><span class="s3">&quot;passed&quot;</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">failed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;Whether the outcome is failed.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">outcome </span><span class="s2">== </span><span class="s3">&quot;failed&quot;</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">skipped</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;Whether the outcome is skipped.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">outcome </span><span class="s2">== </span><span class="s3">&quot;skipped&quot;</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">fspath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;The path portion of the reported node, as a string.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodeid</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;::&quot;</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">]</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">count_towards_summary</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;**Experimental** Whether this report should be counted towards the 
        totals shown at the end of the test session: &quot;1 passed, 1 failure, etc&quot;. 
 
        .. note:: 
 
            This function is considered **experimental**, so beware that it is subject to changes 
            even in patch releases. 
        &quot;&quot;&quot;</span>
        <span class="s0">return True</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">head_line</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">str</span><span class="s2">]:</span>
        <span class="s6">&quot;&quot;&quot;**Experimental** The head line shown with longrepr output for this 
        report, more commonly during traceback representation during 
        failures:: 
 
            ________ Test.foo ________ 
 
 
        In the example above, the head_line is &quot;Test.foo&quot;. 
 
        .. note:: 
 
            This function is considered **experimental**, so beware that it is subject to changes 
            even in patch releases. 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">location </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">fspath</span><span class="s2">, </span><span class="s1">lineno</span><span class="s2">, </span><span class="s1">domain </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">location</span>
            <span class="s0">return </span><span class="s1">domain</span>
        <span class="s0">return None</span>

    <span class="s0">def </span><span class="s1">_get_verbose_word</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">config</span><span class="s2">: </span><span class="s1">Config</span><span class="s2">):</span>
        <span class="s1">_category</span><span class="s2">, </span><span class="s1">_short</span><span class="s2">, </span><span class="s1">verbose </span><span class="s2">= </span><span class="s1">config</span><span class="s2">.</span><span class="s1">hook</span><span class="s2">.</span><span class="s1">pytest_report_teststatus</span><span class="s2">(</span>
            <span class="s1">report</span><span class="s2">=</span><span class="s1">self</span><span class="s2">, </span><span class="s1">config</span><span class="s2">=</span><span class="s1">config</span>
        <span class="s2">)</span>
        <span class="s0">return </span><span class="s1">verbose</span>

    <span class="s0">def </span><span class="s1">_to_json</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]:</span>
        <span class="s6">&quot;&quot;&quot;Return the contents of this report as a dict of builtin entries, 
        suitable for serialization. 
 
        This was originally the serialize_report() function from xdist (ca03269). 
 
        Experimental method. 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">_report_to_json</span><span class="s2">(</span><span class="s1">self</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">_from_json</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">: </span><span class="s1">Type</span><span class="s2">[</span><span class="s1">_R</span><span class="s2">], </span><span class="s1">reportdict</span><span class="s2">: </span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">object</span><span class="s2">]) </span><span class="s1">-&gt; _R</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;Create either a TestReport or CollectReport, depending on the calling class. 
 
        It is the callers responsibility to know which class to pass here. 
 
        This was originally the serialize_report() function from xdist (ca03269). 
 
        Experimental method. 
        &quot;&quot;&quot;</span>
        <span class="s1">kwargs </span><span class="s2">= </span><span class="s1">_report_kwargs_from_json</span><span class="s2">(</span><span class="s1">reportdict</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">_report_unserialization_failure</span><span class="s2">(</span>
    <span class="s1">type_name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">report_class</span><span class="s2">: </span><span class="s1">Type</span><span class="s2">[</span><span class="s1">BaseReport</span><span class="s2">], </span><span class="s1">reportdict</span>
<span class="s2">) </span><span class="s1">-&gt; NoReturn</span><span class="s2">:</span>
    <span class="s1">url </span><span class="s2">= </span><span class="s3">&quot;https://github.com/pytest-dev/pytest/issues&quot;</span>
    <span class="s1">stream </span><span class="s2">= </span><span class="s1">StringIO</span><span class="s2">()</span>
    <span class="s1">pprint</span><span class="s2">(</span><span class="s3">&quot;-&quot; </span><span class="s2">* </span><span class="s4">100</span><span class="s2">, </span><span class="s1">stream</span><span class="s2">=</span><span class="s1">stream</span><span class="s2">)</span>
    <span class="s1">pprint</span><span class="s2">(</span><span class="s3">&quot;INTERNALERROR: Unknown entry type returned: %s&quot; </span><span class="s2">% </span><span class="s1">type_name</span><span class="s2">, </span><span class="s1">stream</span><span class="s2">=</span><span class="s1">stream</span><span class="s2">)</span>
    <span class="s1">pprint</span><span class="s2">(</span><span class="s3">&quot;report_name: %s&quot; </span><span class="s2">% </span><span class="s1">report_class</span><span class="s2">, </span><span class="s1">stream</span><span class="s2">=</span><span class="s1">stream</span><span class="s2">)</span>
    <span class="s1">pprint</span><span class="s2">(</span><span class="s1">reportdict</span><span class="s2">, </span><span class="s1">stream</span><span class="s2">=</span><span class="s1">stream</span><span class="s2">)</span>
    <span class="s1">pprint</span><span class="s2">(</span><span class="s3">&quot;Please report this bug at %s&quot; </span><span class="s2">% </span><span class="s1">url</span><span class="s2">, </span><span class="s1">stream</span><span class="s2">=</span><span class="s1">stream</span><span class="s2">)</span>
    <span class="s1">pprint</span><span class="s2">(</span><span class="s3">&quot;-&quot; </span><span class="s2">* </span><span class="s4">100</span><span class="s2">, </span><span class="s1">stream</span><span class="s2">=</span><span class="s1">stream</span><span class="s2">)</span>
    <span class="s0">raise </span><span class="s1">RuntimeError</span><span class="s2">(</span><span class="s1">stream</span><span class="s2">.</span><span class="s1">getvalue</span><span class="s2">())</span>


<span class="s2">@</span><span class="s1">final</span>
<span class="s0">class </span><span class="s1">TestReport</span><span class="s2">(</span><span class="s1">BaseReport</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Basic test report object (also used for setup and teardown calls if 
    they fail). 
 
    Reports can contain arbitrary extra attributes. 
    &quot;&quot;&quot;</span>

    <span class="s1">__test__ </span><span class="s2">= </span><span class="s0">False</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">nodeid</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
        <span class="s1">location</span><span class="s2">: </span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">int</span><span class="s2">], </span><span class="s1">str</span><span class="s2">],</span>
        <span class="s1">keywords</span><span class="s2">: </span><span class="s1">Mapping</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">],</span>
        <span class="s1">outcome</span><span class="s2">: </span><span class="s3">&quot;Literal['passed', 'failed', 'skipped']&quot;</span><span class="s2">,</span>
        <span class="s1">longrepr</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span>
            <span class="s0">None</span><span class="s2">, </span><span class="s1">ExceptionInfo</span><span class="s2">[</span><span class="s1">BaseException</span><span class="s2">], </span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">int</span><span class="s2">, </span><span class="s1">str</span><span class="s2">], </span><span class="s1">str</span><span class="s2">, </span><span class="s1">TerminalRepr</span>
        <span class="s2">],</span>
        <span class="s1">when</span><span class="s2">: </span><span class="s3">&quot;Literal['setup', 'call', 'teardown']&quot;</span><span class="s2">,</span>
        <span class="s1">sections</span><span class="s2">: </span><span class="s1">Iterable</span><span class="s2">[</span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">str</span><span class="s2">]] = (),</span>
        <span class="s1">duration</span><span class="s2">: </span><span class="s1">float </span><span class="s2">= </span><span class="s4">0</span><span class="s2">,</span>
        <span class="s1">start</span><span class="s2">: </span><span class="s1">float </span><span class="s2">= </span><span class="s4">0</span><span class="s2">,</span>
        <span class="s1">stop</span><span class="s2">: </span><span class="s1">float </span><span class="s2">= </span><span class="s4">0</span><span class="s2">,</span>
        <span class="s1">user_properties</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Iterable</span><span class="s2">[</span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">object</span><span class="s2">]]] = </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s2">**</span><span class="s1">extra</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s5">#: Normalized collection nodeid.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodeid </span><span class="s2">= </span><span class="s1">nodeid</span>

        <span class="s5">#: A (filesystempath, lineno, domaininfo) tuple indicating the</span>
        <span class="s5">#: actual location of a test item - it might be different from the</span>
        <span class="s5">#: collected one e.g. if a method is inherited from a different module.</span>
        <span class="s5">#: The filesystempath may be relative to ``config.rootdir``.</span>
        <span class="s5">#: The line number is 0-based.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">location</span><span class="s2">: </span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">int</span><span class="s2">], </span><span class="s1">str</span><span class="s2">] = </span><span class="s1">location</span>

        <span class="s5">#: A name -&gt; value dictionary containing all keywords and</span>
        <span class="s5">#: markers associated with a test invocation.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">keywords</span><span class="s2">: </span><span class="s1">Mapping</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">] = </span><span class="s1">keywords</span>

        <span class="s5">#: Test outcome, always one of &quot;passed&quot;, &quot;failed&quot;, &quot;skipped&quot;.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">outcome </span><span class="s2">= </span><span class="s1">outcome</span>

        <span class="s5">#: None or a failure representation.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">longrepr </span><span class="s2">= </span><span class="s1">longrepr</span>

        <span class="s5">#: One of 'setup', 'call', 'teardown' to indicate runtest phase.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">when </span><span class="s2">= </span><span class="s1">when</span>

        <span class="s5">#: User properties is a list of tuples (name, value) that holds user</span>
        <span class="s5">#: defined properties of the test.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">user_properties </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">user_properties </span><span class="s0">or </span><span class="s2">[])</span>

        <span class="s5">#: Tuples of str ``(heading, content)`` with extra information</span>
        <span class="s5">#: for the test report. Used by pytest to add text captured</span>
        <span class="s5">#: from ``stdout``, ``stderr``, and intercepted logging events. May</span>
        <span class="s5">#: be used by other plugins to add arbitrary information to reports.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">sections </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">sections</span><span class="s2">)</span>

        <span class="s5">#: Time it took to run just the test.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">duration</span><span class="s2">: </span><span class="s1">float </span><span class="s2">= </span><span class="s1">duration</span>

        <span class="s5">#: The system time when the call started, in seconds since the epoch.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">start</span><span class="s2">: </span><span class="s1">float </span><span class="s2">= </span><span class="s1">start</span>
        <span class="s5">#: The system time when the call ended, in seconds since the epoch.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">stop</span><span class="s2">: </span><span class="s1">float </span><span class="s2">= </span><span class="s1">stop</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">extra</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s3">&quot;&lt;{} {!r} when={!r} outcome={!r}&gt;&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">nodeid</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">when</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">outcome</span>
        <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">from_item_and_call</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">item</span><span class="s2">: </span><span class="s1">Item</span><span class="s2">, </span><span class="s1">call</span><span class="s2">: </span><span class="s3">&quot;CallInfo[None]&quot;</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s3">&quot;TestReport&quot;</span><span class="s2">:</span>
        <span class="s6">&quot;&quot;&quot;Create and fill a TestReport with standard item and call info. 
 
        :param item: The item. 
        :param call: The call info. 
        &quot;&quot;&quot;</span>
        <span class="s1">when </span><span class="s2">= </span><span class="s1">call</span><span class="s2">.</span><span class="s1">when</span>
        <span class="s5"># Remove &quot;collect&quot; from the Literal type -- only for collection calls.</span>
        <span class="s0">assert </span><span class="s1">when </span><span class="s2">!= </span><span class="s3">&quot;collect&quot;</span>
        <span class="s1">duration </span><span class="s2">= </span><span class="s1">call</span><span class="s2">.</span><span class="s1">duration</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">call</span><span class="s2">.</span><span class="s1">start</span>
        <span class="s1">stop </span><span class="s2">= </span><span class="s1">call</span><span class="s2">.</span><span class="s1">stop</span>
        <span class="s1">keywords </span><span class="s2">= {</span><span class="s1">x</span><span class="s2">: </span><span class="s4">1 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">item</span><span class="s2">.</span><span class="s1">keywords</span><span class="s2">}</span>
        <span class="s1">excinfo </span><span class="s2">= </span><span class="s1">call</span><span class="s2">.</span><span class="s1">excinfo</span>
        <span class="s1">sections </span><span class="s2">= []</span>
        <span class="s0">if not </span><span class="s1">call</span><span class="s2">.</span><span class="s1">excinfo</span><span class="s2">:</span>
            <span class="s1">outcome</span><span class="s2">: </span><span class="s1">Literal</span><span class="s2">[</span><span class="s3">&quot;passed&quot;</span><span class="s2">, </span><span class="s3">&quot;failed&quot;</span><span class="s2">, </span><span class="s3">&quot;skipped&quot;</span><span class="s2">] = </span><span class="s3">&quot;passed&quot;</span>
            <span class="s1">longrepr</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span>
                <span class="s0">None</span><span class="s2">,</span>
                <span class="s1">ExceptionInfo</span><span class="s2">[</span><span class="s1">BaseException</span><span class="s2">],</span>
                <span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">int</span><span class="s2">, </span><span class="s1">str</span><span class="s2">],</span>
                <span class="s1">str</span><span class="s2">,</span>
                <span class="s1">TerminalRepr</span><span class="s2">,</span>
            <span class="s2">] = </span><span class="s0">None</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">excinfo</span><span class="s2">, </span><span class="s1">ExceptionInfo</span><span class="s2">):</span>
                <span class="s1">outcome </span><span class="s2">= </span><span class="s3">&quot;failed&quot;</span>
                <span class="s1">longrepr </span><span class="s2">= </span><span class="s1">excinfo</span>
            <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">excinfo</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">skip</span><span class="s2">.</span><span class="s1">Exception</span><span class="s2">):</span>
                <span class="s1">outcome </span><span class="s2">= </span><span class="s3">&quot;skipped&quot;</span>
                <span class="s1">r </span><span class="s2">= </span><span class="s1">excinfo</span><span class="s2">.</span><span class="s1">_getreprcrash</span><span class="s2">()</span>
                <span class="s0">assert </span><span class="s2">(</span>
                    <span class="s1">r </span><span class="s0">is not None</span>
                <span class="s2">), </span><span class="s3">&quot;There should always be a traceback entry for skipping a test.&quot;</span>
                <span class="s0">if </span><span class="s1">excinfo</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">_use_item_location</span><span class="s2">:</span>
                    <span class="s1">path</span><span class="s2">, </span><span class="s1">line </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">reportinfo</span><span class="s2">()[:</span><span class="s4">2</span><span class="s2">]</span>
                    <span class="s0">assert </span><span class="s1">line </span><span class="s0">is not None</span>
                    <span class="s1">longrepr </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">fspath</span><span class="s2">(</span><span class="s1">path</span><span class="s2">), </span><span class="s1">line </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">, </span><span class="s1">r</span><span class="s2">.</span><span class="s1">message</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">longrepr </span><span class="s2">= (</span><span class="s1">str</span><span class="s2">(</span><span class="s1">r</span><span class="s2">.</span><span class="s1">path</span><span class="s2">), </span><span class="s1">r</span><span class="s2">.</span><span class="s1">lineno</span><span class="s2">, </span><span class="s1">r</span><span class="s2">.</span><span class="s1">message</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">outcome </span><span class="s2">= </span><span class="s3">&quot;failed&quot;</span>
                <span class="s0">if </span><span class="s1">call</span><span class="s2">.</span><span class="s1">when </span><span class="s2">== </span><span class="s3">&quot;call&quot;</span><span class="s2">:</span>
                    <span class="s1">longrepr </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">repr_failure</span><span class="s2">(</span><span class="s1">excinfo</span><span class="s2">)</span>
                <span class="s0">else</span><span class="s2">:  </span><span class="s5"># exception in setup or teardown</span>
                    <span class="s1">longrepr </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">_repr_failure_py</span><span class="s2">(</span>
                        <span class="s1">excinfo</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s1">item</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">getoption</span><span class="s2">(</span><span class="s3">&quot;tbstyle&quot;</span><span class="s2">, </span><span class="s3">&quot;auto&quot;</span><span class="s2">)</span>
                    <span class="s2">)</span>
        <span class="s0">for </span><span class="s1">rwhen</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">content </span><span class="s0">in </span><span class="s1">item</span><span class="s2">.</span><span class="s1">_report_sections</span><span class="s2">:</span>
            <span class="s1">sections</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s3">f&quot;Captured </span><span class="s0">{</span><span class="s1">key</span><span class="s0">} {</span><span class="s1">rwhen</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">content</span><span class="s2">))</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">(</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">nodeid</span><span class="s2">,</span>
            <span class="s1">item</span><span class="s2">.</span><span class="s1">location</span><span class="s2">,</span>
            <span class="s1">keywords</span><span class="s2">,</span>
            <span class="s1">outcome</span><span class="s2">,</span>
            <span class="s1">longrepr</span><span class="s2">,</span>
            <span class="s1">when</span><span class="s2">,</span>
            <span class="s1">sections</span><span class="s2">,</span>
            <span class="s1">duration</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">,</span>
            <span class="s1">stop</span><span class="s2">,</span>
            <span class="s1">user_properties</span><span class="s2">=</span><span class="s1">item</span><span class="s2">.</span><span class="s1">user_properties</span><span class="s2">,</span>
        <span class="s2">)</span>


<span class="s2">@</span><span class="s1">final</span>
<span class="s0">class </span><span class="s1">CollectReport</span><span class="s2">(</span><span class="s1">BaseReport</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Collection report object. 
 
    Reports can contain arbitrary extra attributes. 
    &quot;&quot;&quot;</span>

    <span class="s1">when </span><span class="s2">= </span><span class="s3">&quot;collect&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">nodeid</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
        <span class="s1">outcome</span><span class="s2">: </span><span class="s3">&quot;Literal['passed', 'failed', 'skipped']&quot;</span><span class="s2">,</span>
        <span class="s1">longrepr</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span>
            <span class="s0">None</span><span class="s2">, </span><span class="s1">ExceptionInfo</span><span class="s2">[</span><span class="s1">BaseException</span><span class="s2">], </span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">int</span><span class="s2">, </span><span class="s1">str</span><span class="s2">], </span><span class="s1">str</span><span class="s2">, </span><span class="s1">TerminalRepr</span>
        <span class="s2">],</span>
        <span class="s1">result</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">List</span><span class="s2">[</span><span class="s1">Union</span><span class="s2">[</span><span class="s1">Item</span><span class="s2">, </span><span class="s1">Collector</span><span class="s2">]]],</span>
        <span class="s1">sections</span><span class="s2">: </span><span class="s1">Iterable</span><span class="s2">[</span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">str</span><span class="s2">]] = (),</span>
        <span class="s2">**</span><span class="s1">extra</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s5">#: Normalized collection nodeid.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">nodeid </span><span class="s2">= </span><span class="s1">nodeid</span>

        <span class="s5">#: Test outcome, always one of &quot;passed&quot;, &quot;failed&quot;, &quot;skipped&quot;.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">outcome </span><span class="s2">= </span><span class="s1">outcome</span>

        <span class="s5">#: None or a failure representation.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">longrepr </span><span class="s2">= </span><span class="s1">longrepr</span>

        <span class="s5">#: The collected items and collection nodes.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">result </span><span class="s2">= </span><span class="s1">result </span><span class="s0">or </span><span class="s2">[]</span>

        <span class="s5">#: Tuples of str ``(heading, content)`` with extra information</span>
        <span class="s5">#: for the test report. Used by pytest to add text captured</span>
        <span class="s5">#: from ``stdout``, ``stderr``, and intercepted logging events. May</span>
        <span class="s5">#: be used by other plugins to add arbitrary information to reports.</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">sections </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">sections</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">extra</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">location</span><span class="s2">(  </span><span class="s5"># type:ignore[override]</span>
        <span class="s1">self</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">Tuple</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">int</span><span class="s2">], </span><span class="s1">str</span><span class="s2">]]:</span>
        <span class="s0">return </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">fspath</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">fspath</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s3">&quot;&lt;CollectReport {!r} lenresult={} outcome={!r}&gt;&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">nodeid</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">result</span><span class="s2">), </span><span class="s1">self</span><span class="s2">.</span><span class="s1">outcome</span>
        <span class="s2">)</span>


<span class="s0">class </span><span class="s1">CollectErrorRepr</span><span class="s2">(</span><span class="s1">TerminalRepr</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">longrepr </span><span class="s2">= </span><span class="s1">msg</span>

    <span class="s0">def </span><span class="s1">toterminal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">out</span><span class="s2">: </span><span class="s1">TerminalWriter</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">out</span><span class="s2">.</span><span class="s1">line</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">longrepr</span><span class="s2">, </span><span class="s1">red</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">pytest_report_to_serializable</span><span class="s2">(</span>
    <span class="s1">report</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span><span class="s1">CollectReport</span><span class="s2">, </span><span class="s1">TestReport</span><span class="s2">]</span>
<span class="s2">) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]]:</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">report</span><span class="s2">, (</span><span class="s1">TestReport</span><span class="s2">, </span><span class="s1">CollectReport</span><span class="s2">)):</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">report</span><span class="s2">.</span><span class="s1">_to_json</span><span class="s2">()</span>
        <span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;$report_type&quot;</span><span class="s2">] = </span><span class="s1">report</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">__name__</span>
        <span class="s0">return </span><span class="s1">data</span>
    <span class="s5"># TODO: Check if this is actually reachable.</span>
    <span class="s0">return None  </span><span class="s5"># type: ignore[unreachable]</span>


<span class="s0">def </span><span class="s1">pytest_report_from_serializable</span><span class="s2">(</span>
    <span class="s1">data</span><span class="s2">: </span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">],</span>
<span class="s2">) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">Union</span><span class="s2">[</span><span class="s1">CollectReport</span><span class="s2">, </span><span class="s1">TestReport</span><span class="s2">]]:</span>
    <span class="s0">if </span><span class="s3">&quot;$report_type&quot; </span><span class="s0">in </span><span class="s1">data</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;$report_type&quot;</span><span class="s2">] == </span><span class="s3">&quot;TestReport&quot;</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">TestReport</span><span class="s2">.</span><span class="s1">_from_json</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;$report_type&quot;</span><span class="s2">] == </span><span class="s3">&quot;CollectReport&quot;</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">CollectReport</span><span class="s2">.</span><span class="s1">_from_json</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s0">assert False</span><span class="s2">, </span><span class="s3">&quot;Unknown report_type unserialize data: {}&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
            <span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;$report_type&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
    <span class="s0">return None</span>


<span class="s0">def </span><span class="s1">_report_to_json</span><span class="s2">(</span><span class="s1">report</span><span class="s2">: </span><span class="s1">BaseReport</span><span class="s2">) </span><span class="s1">-&gt; Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]:</span>
    <span class="s6">&quot;&quot;&quot;Return the contents of this report as a dict of builtin entries, 
    suitable for serialization. 
 
    This was originally the serialize_report() function from xdist (ca03269). 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">serialize_repr_entry</span><span class="s2">(</span>
        <span class="s1">entry</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span><span class="s1">ReprEntry</span><span class="s2">, </span><span class="s1">ReprEntryNative</span><span class="s2">]</span>
    <span class="s2">) </span><span class="s1">-&gt; Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]:</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dataclasses</span><span class="s2">.</span><span class="s1">asdict</span><span class="s2">(</span><span class="s1">entry</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">data</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
            <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s3">&quot;__dict__&quot;</span><span class="s2">):</span>
                <span class="s1">data</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">dataclasses</span><span class="s2">.</span><span class="s1">asdict</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">entry_data </span><span class="s2">= {</span><span class="s3">&quot;type&quot;</span><span class="s2">: </span><span class="s1">type</span><span class="s2">(</span><span class="s1">entry</span><span class="s2">).</span><span class="s1">__name__</span><span class="s2">, </span><span class="s3">&quot;data&quot;</span><span class="s2">: </span><span class="s1">data</span><span class="s2">}</span>
        <span class="s0">return </span><span class="s1">entry_data</span>

    <span class="s0">def </span><span class="s1">serialize_repr_traceback</span><span class="s2">(</span><span class="s1">reprtraceback</span><span class="s2">: </span><span class="s1">ReprTraceback</span><span class="s2">) </span><span class="s1">-&gt; Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]:</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dataclasses</span><span class="s2">.</span><span class="s1">asdict</span><span class="s2">(</span><span class="s1">reprtraceback</span><span class="s2">)</span>
        <span class="s1">result</span><span class="s2">[</span><span class="s3">&quot;reprentries&quot;</span><span class="s2">] = [</span>
            <span class="s1">serialize_repr_entry</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">reprtraceback</span><span class="s2">.</span><span class="s1">reprentries</span>
        <span class="s2">]</span>
        <span class="s0">return </span><span class="s1">result</span>

    <span class="s0">def </span><span class="s1">serialize_repr_crash</span><span class="s2">(</span>
        <span class="s1">reprcrash</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">ReprFileLocation</span><span class="s2">],</span>
    <span class="s2">) </span><span class="s1">-&gt; Optional</span><span class="s2">[</span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]]:</span>
        <span class="s0">if </span><span class="s1">reprcrash </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">dataclasses</span><span class="s2">.</span><span class="s1">asdict</span><span class="s2">(</span><span class="s1">reprcrash</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return None</span>

    <span class="s0">def </span><span class="s1">serialize_exception_longrepr</span><span class="s2">(</span><span class="s1">rep</span><span class="s2">: </span><span class="s1">BaseReport</span><span class="s2">) </span><span class="s1">-&gt; Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]:</span>
        <span class="s0">assert </span><span class="s1">rep</span><span class="s2">.</span><span class="s1">longrepr </span><span class="s0">is not None</span>
        <span class="s5"># TODO: Investigate whether the duck typing is really necessary here.</span>
        <span class="s1">longrepr </span><span class="s2">= </span><span class="s1">cast</span><span class="s2">(</span><span class="s1">ExceptionRepr</span><span class="s2">, </span><span class="s1">rep</span><span class="s2">.</span><span class="s1">longrepr</span><span class="s2">)</span>
        <span class="s1">result</span><span class="s2">: </span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">] = {</span>
            <span class="s3">&quot;reprcrash&quot;</span><span class="s2">: </span><span class="s1">serialize_repr_crash</span><span class="s2">(</span><span class="s1">longrepr</span><span class="s2">.</span><span class="s1">reprcrash</span><span class="s2">),</span>
            <span class="s3">&quot;reprtraceback&quot;</span><span class="s2">: </span><span class="s1">serialize_repr_traceback</span><span class="s2">(</span><span class="s1">longrepr</span><span class="s2">.</span><span class="s1">reprtraceback</span><span class="s2">),</span>
            <span class="s3">&quot;sections&quot;</span><span class="s2">: </span><span class="s1">longrepr</span><span class="s2">.</span><span class="s1">sections</span><span class="s2">,</span>
        <span class="s2">}</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">longrepr</span><span class="s2">, </span><span class="s1">ExceptionChainRepr</span><span class="s2">):</span>
            <span class="s1">result</span><span class="s2">[</span><span class="s3">&quot;chain&quot;</span><span class="s2">] = []</span>
            <span class="s0">for </span><span class="s1">repr_traceback</span><span class="s2">, </span><span class="s1">repr_crash</span><span class="s2">, </span><span class="s1">description </span><span class="s0">in </span><span class="s1">longrepr</span><span class="s2">.</span><span class="s1">chain</span><span class="s2">:</span>
                <span class="s1">result</span><span class="s2">[</span><span class="s3">&quot;chain&quot;</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span>
                    <span class="s2">(</span>
                        <span class="s1">serialize_repr_traceback</span><span class="s2">(</span><span class="s1">repr_traceback</span><span class="s2">),</span>
                        <span class="s1">serialize_repr_crash</span><span class="s2">(</span><span class="s1">repr_crash</span><span class="s2">),</span>
                        <span class="s1">description</span><span class="s2">,</span>
                    <span class="s2">)</span>
                <span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">result</span><span class="s2">[</span><span class="s3">&quot;chain&quot;</span><span class="s2">] = </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">result</span>

    <span class="s1">d </span><span class="s2">= </span><span class="s1">report</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">report</span><span class="s2">.</span><span class="s1">longrepr</span><span class="s2">, </span><span class="s3">&quot;toterminal&quot;</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">report</span><span class="s2">.</span><span class="s1">longrepr</span><span class="s2">, </span><span class="s3">&quot;reprtraceback&quot;</span><span class="s2">) </span><span class="s0">and </span><span class="s1">hasattr</span><span class="s2">(</span>
            <span class="s1">report</span><span class="s2">.</span><span class="s1">longrepr</span><span class="s2">, </span><span class="s3">&quot;reprcrash&quot;</span>
        <span class="s2">):</span>
            <span class="s1">d</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">] = </span><span class="s1">serialize_exception_longrepr</span><span class="s2">(</span><span class="s1">report</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">d</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">] = </span><span class="s1">str</span><span class="s2">(</span><span class="s1">report</span><span class="s2">.</span><span class="s1">longrepr</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">d</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">] = </span><span class="s1">report</span><span class="s2">.</span><span class="s1">longrepr</span>
    <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">d</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">d</span><span class="s2">[</span><span class="s1">name</span><span class="s2">], </span><span class="s1">os</span><span class="s2">.</span><span class="s1">PathLike</span><span class="s2">):</span>
            <span class="s1">d</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">os</span><span class="s2">.</span><span class="s1">fspath</span><span class="s2">(</span><span class="s1">d</span><span class="s2">[</span><span class="s1">name</span><span class="s2">])</span>
        <span class="s0">elif </span><span class="s1">name </span><span class="s2">== </span><span class="s3">&quot;result&quot;</span><span class="s2">:</span>
            <span class="s1">d</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s0">None  </span><span class="s5"># for now</span>
    <span class="s0">return </span><span class="s1">d</span>


<span class="s0">def </span><span class="s1">_report_kwargs_from_json</span><span class="s2">(</span><span class="s1">reportdict</span><span class="s2">: </span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]) </span><span class="s1">-&gt; Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]:</span>
    <span class="s6">&quot;&quot;&quot;Return **kwargs that can be used to construct a TestReport or 
    CollectReport instance. 
 
    This was originally the serialize_report() function from xdist (ca03269). 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">deserialize_repr_entry</span><span class="s2">(</span><span class="s1">entry_data</span><span class="s2">):</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">entry_data</span><span class="s2">[</span><span class="s3">&quot;data&quot;</span><span class="s2">]</span>
        <span class="s1">entry_type </span><span class="s2">= </span><span class="s1">entry_data</span><span class="s2">[</span><span class="s3">&quot;type&quot;</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s1">entry_type </span><span class="s2">== </span><span class="s3">&quot;ReprEntry&quot;</span><span class="s2">:</span>
            <span class="s1">reprfuncargs </span><span class="s2">= </span><span class="s0">None</span>
            <span class="s1">reprfileloc </span><span class="s2">= </span><span class="s0">None</span>
            <span class="s1">reprlocals </span><span class="s2">= </span><span class="s0">None</span>
            <span class="s0">if </span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;reprfuncargs&quot;</span><span class="s2">]:</span>
                <span class="s1">reprfuncargs </span><span class="s2">= </span><span class="s1">ReprFuncArgs</span><span class="s2">(**</span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;reprfuncargs&quot;</span><span class="s2">])</span>
            <span class="s0">if </span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;reprfileloc&quot;</span><span class="s2">]:</span>
                <span class="s1">reprfileloc </span><span class="s2">= </span><span class="s1">ReprFileLocation</span><span class="s2">(**</span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;reprfileloc&quot;</span><span class="s2">])</span>
            <span class="s0">if </span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;reprlocals&quot;</span><span class="s2">]:</span>
                <span class="s1">reprlocals </span><span class="s2">= </span><span class="s1">ReprLocals</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;reprlocals&quot;</span><span class="s2">][</span><span class="s3">&quot;lines&quot;</span><span class="s2">])</span>

            <span class="s1">reprentry</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span><span class="s1">ReprEntry</span><span class="s2">, </span><span class="s1">ReprEntryNative</span><span class="s2">] = </span><span class="s1">ReprEntry</span><span class="s2">(</span>
                <span class="s1">lines</span><span class="s2">=</span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;lines&quot;</span><span class="s2">],</span>
                <span class="s1">reprfuncargs</span><span class="s2">=</span><span class="s1">reprfuncargs</span><span class="s2">,</span>
                <span class="s1">reprlocals</span><span class="s2">=</span><span class="s1">reprlocals</span><span class="s2">,</span>
                <span class="s1">reprfileloc</span><span class="s2">=</span><span class="s1">reprfileloc</span><span class="s2">,</span>
                <span class="s1">style</span><span class="s2">=</span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;style&quot;</span><span class="s2">],</span>
            <span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">entry_type </span><span class="s2">== </span><span class="s3">&quot;ReprEntryNative&quot;</span><span class="s2">:</span>
            <span class="s1">reprentry </span><span class="s2">= </span><span class="s1">ReprEntryNative</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s3">&quot;lines&quot;</span><span class="s2">])</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">_report_unserialization_failure</span><span class="s2">(</span><span class="s1">entry_type</span><span class="s2">, </span><span class="s1">TestReport</span><span class="s2">, </span><span class="s1">reportdict</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">reprentry</span>

    <span class="s0">def </span><span class="s1">deserialize_repr_traceback</span><span class="s2">(</span><span class="s1">repr_traceback_dict</span><span class="s2">):</span>
        <span class="s1">repr_traceback_dict</span><span class="s2">[</span><span class="s3">&quot;reprentries&quot;</span><span class="s2">] = [</span>
            <span class="s1">deserialize_repr_entry</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">repr_traceback_dict</span><span class="s2">[</span><span class="s3">&quot;reprentries&quot;</span><span class="s2">]</span>
        <span class="s2">]</span>
        <span class="s0">return </span><span class="s1">ReprTraceback</span><span class="s2">(**</span><span class="s1">repr_traceback_dict</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">deserialize_repr_crash</span><span class="s2">(</span><span class="s1">repr_crash_dict</span><span class="s2">: </span><span class="s1">Optional</span><span class="s2">[</span><span class="s1">Dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">Any</span><span class="s2">]]):</span>
        <span class="s0">if </span><span class="s1">repr_crash_dict </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">ReprFileLocation</span><span class="s2">(**</span><span class="s1">repr_crash_dict</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return None</span>

    <span class="s0">if </span><span class="s2">(</span>
        <span class="s1">reportdict</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">]</span>
        <span class="s0">and </span><span class="s3">&quot;reprcrash&quot; </span><span class="s0">in </span><span class="s1">reportdict</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">]</span>
        <span class="s0">and </span><span class="s3">&quot;reprtraceback&quot; </span><span class="s0">in </span><span class="s1">reportdict</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">]</span>
    <span class="s2">):</span>
        <span class="s1">reprtraceback </span><span class="s2">= </span><span class="s1">deserialize_repr_traceback</span><span class="s2">(</span>
            <span class="s1">reportdict</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">][</span><span class="s3">&quot;reprtraceback&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">reprcrash </span><span class="s2">= </span><span class="s1">deserialize_repr_crash</span><span class="s2">(</span><span class="s1">reportdict</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">][</span><span class="s3">&quot;reprcrash&quot;</span><span class="s2">])</span>
        <span class="s0">if </span><span class="s1">reportdict</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">][</span><span class="s3">&quot;chain&quot;</span><span class="s2">]:</span>
            <span class="s1">chain </span><span class="s2">= []</span>
            <span class="s0">for </span><span class="s1">repr_traceback_data</span><span class="s2">, </span><span class="s1">repr_crash_data</span><span class="s2">, </span><span class="s1">description </span><span class="s0">in </span><span class="s1">reportdict</span><span class="s2">[</span>
                <span class="s3">&quot;longrepr&quot;</span>
            <span class="s2">][</span><span class="s3">&quot;chain&quot;</span><span class="s2">]:</span>
                <span class="s1">chain</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span>
                    <span class="s2">(</span>
                        <span class="s1">deserialize_repr_traceback</span><span class="s2">(</span><span class="s1">repr_traceback_data</span><span class="s2">),</span>
                        <span class="s1">deserialize_repr_crash</span><span class="s2">(</span><span class="s1">repr_crash_data</span><span class="s2">),</span>
                        <span class="s1">description</span><span class="s2">,</span>
                    <span class="s2">)</span>
                <span class="s2">)</span>
            <span class="s1">exception_info</span><span class="s2">: </span><span class="s1">Union</span><span class="s2">[</span>
                <span class="s1">ExceptionChainRepr</span><span class="s2">, </span><span class="s1">ReprExceptionInfo</span>
            <span class="s2">] = </span><span class="s1">ExceptionChainRepr</span><span class="s2">(</span><span class="s1">chain</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">exception_info </span><span class="s2">= </span><span class="s1">ReprExceptionInfo</span><span class="s2">(</span>
                <span class="s1">reprtraceback</span><span class="s2">=</span><span class="s1">reprtraceback</span><span class="s2">,</span>
                <span class="s1">reprcrash</span><span class="s2">=</span><span class="s1">reprcrash</span><span class="s2">,</span>
            <span class="s2">)</span>

        <span class="s0">for </span><span class="s1">section </span><span class="s0">in </span><span class="s1">reportdict</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">][</span><span class="s3">&quot;sections&quot;</span><span class="s2">]:</span>
            <span class="s1">exception_info</span><span class="s2">.</span><span class="s1">addsection</span><span class="s2">(*</span><span class="s1">section</span><span class="s2">)</span>
        <span class="s1">reportdict</span><span class="s2">[</span><span class="s3">&quot;longrepr&quot;</span><span class="s2">] = </span><span class="s1">exception_info</span>

    <span class="s0">return </span><span class="s1">reportdict</span>
</pre>
</body>
</html>